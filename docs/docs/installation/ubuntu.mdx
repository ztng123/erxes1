---
id: ubuntu
title: Ubuntu 18.04
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

## Server Installation Requirements

erxes gives you many options for installing the erxes platform. Below you will find two guides. The first guide is the **Quick Start** guide where we provide a script that automates most of the installation process. The second guide is a comprehensive, **Step by Step** guide where advanced developers can see exactly what is being installed and how.

:::info Ubuntu 18.04
These instructions are for installing erxes on **Ubuntu 18.04**. They should work on any hosting provider that allows you to install Ubuntu 18.04.
:::

### Minimum required server resources

Each hosting company has slightly different server configurations and set-ups. Hosting companies such as [Linode.com](https://www.linode.com/), [Digital Ocean](https://digitalocean.com) and [AWS EC2](https://aws.amazon.com/ec2) offer many different server specifications and configuration options.

To properly install and maintain your erxes installation, the minimum requirements are:

- Ubuntu 18.04 (or other supported Linus distribution)
- 4 cpus
- 8GB RAM
- ability to to SSH into the server

:::tip Use one-click installs
You can also use the [Digital Ocean Marketplace](https://marketplace.digitalocean.com/apps/erxes) and [AWS Marketplace](https://aws.amazon.com/marketplace/pp/B086MZ9FVS?qid=1594055516154&sr=0-1&ref_=srh_res_product_title) for an even easier set-up experience.
:::

### Setting up a server with Ubuntu 18.04

- You must have an account with your hosting provider prior to doing these steps.
- You need to create a server with **Ubuntu 18.04** installed, a minimum of **4cpus** and **8GB RAM**. At this time, erxes needs a minimum of 4 cpus and 8GB RAM to finish installation.

### Configure your DNS Records to point at your server

- Your server will have an ip address. You will need to point your `A records` under the _DNS Editor_ for the domain which will host your erxes installation. The propagation is often reported to take up to 24 hours. Most of the time, propagation of your domain name happens within the hour.

:::note Example with a domain called, example.com

If your domain name is **example.com**, and the **ip address** assigned to your server is **44.123.32.12**, then you will have two `A records` that look like this:

| Type | Name            | Value                  |
| ---- | --------------- | ---------------------- |
| A    | www.example.com | points to 44.123.32.12 |

:::

:::note Example with a subdomain called, erxes.example.com

If your domain name is **erxes.example.com**, and the **ip address** assigned to your server is **44.123.32.12**, then you will have two `A records` that look like this:

| Type | Name              | Value                  |
| ---- | ----------------- | ---------------------- |
| A    | erxes.example.com | points to 44.123.32.12 |

**Note:** You do not need to create a subdomain named "erxes.example.com", you can use another name of your choice such as "admin.example.com".
:::

<Tabs
  defaultValue='step-by-step'
  values={[
    { label: 'Quickstart', value: 'quickstart' },
    { label: 'Step by Step', value: 'step-by-step' },
]}>

<TabItem value='quickstart'>

## Installing erxes on Ubuntu 18.04

You can simply follow [Debian doc](/installation/debian10) to install manually.

</TabItem>
<TabItem value='step-by-step'>

## Log into server as root and create erxes user

- Open the terminal or command prompt on your computer. (You will need your **IP address**. In the above example, **44.123.32.12**).

```bash
$ # example ssh root@44.123.32.12
$ ssh root@your-ip-address

    The authenticity of host '44.123.32.12 (44.123.32.12)' can't be established.
    ECDSA key fingerprint is SHA256:RbrZOxtr/emNySeNd8rh2C9VPGY76JbSs1Dhpvfkfrk.
    Are you sure you want to continue connecting (yes/no/[fingerprint])?

$ Yes

    Warning: Permanently added '44.123.32.12' (ECDSA) to the list of known hosts.
    Welcome to Ubuntu 18.04.4 LTS (GNU/Linux 4.15.0-101-generic x86_64)
```

- Add a user called, "erxes" and grant that user administrative access rights

You don't want to use the **root** user to administer your server. So everything will be done by a user called, **erxes**. To accomplish this run the following commands. They will add a user called **erxes**, give it a password and assign administrative access rights.

```bash
$ adduser erxes

    Adding user `erxes' ...
    Adding new group `erxes' (1000) ...
    Adding new user `erxes' (1000) with group `erxes' ...
    Creating home directory `/home/erxes' ...
    Copying files from `/etc/skel' ...

$ Enter new UNIX password: erxes123
$ Retype new UNIX password: erxes123

    passwd: password updated successfully
    Changing the user information for erxes
    Enter the new value, or press ENTER for the default

    	Full Name []:
        Room Number []:
        Work Phone []:
        Home Phone []:
        Other []:

$ Is the information correct? [Y/n] y

$ usermod -aG sudo erxes
```

## Set-up a basic firewall for SSH, nginx 80 and port 443

- Allow OpenSSH, enable it and check the status. OpenSSH will use **port 22**.

```bash

$ ufw allow OpenSSH

    Rules updated
    Rules updated (v6)

$ ufw enable
$ Command may disrupt existing ssh connections. Proceed with operation (y|n)? y

    Firewall is active and enabled on system startup


$ ufw status

Status: active

To                         Action      From
--                         ------      ----
OpenSSH                    ALLOW       Anywhere
OpenSSH (v6)               ALLOW       Anywhere (v6)

```

Your output should like something like the above.

-- Open port 80 (for NGINX) and open port 443. Port 80 allows **http** traffic and port 443 allows **https** traffic.

```bash

$ ufw allow proto tcp from any to any port 80,443

Rule added
Rule added (v6)

$ Command may disrupt existing ssh connections. Proceed with operation (y|n)? y

Firewall is active and enabled on system startup

$ ufw status

Status: active

To                         Action      From
--                         ------      ----
OpenSSH                    ALLOW       Anywhere
80,443/tcp                 ALLOW       Anywhere
OpenSSH (v6)               ALLOW       Anywhere (v6)
80,443/tcp (v6)            ALLOW       Anywhere (v6)

```

- Exit from server, so that you can log back in as **erxes**

```bash
$ exit

logout
Connection to 44.123.32.12 closed.
```

- Log back into the server as the **erxes** user and provide the password

```bash
$ ssh erxes@44.123.32.12
$ erxes@45.79.248.46's password:

Welcome to Ubuntu 18.04.4 LTS (GNU/Linux 4.15.0-101-generic x86_64)
```

In the following section, you will install software dependencies that are needed to run erxes. You will also need to install various tools that will help to administer your server or install the packages themselves.

## Nvm install

**Node Version Manage (nvm)** is a tool that allows you to download and install [Node.js](https://nodejs.org/). You can read more about the installation process here: [How to install NVM](https://gist.github.com/d2s/372b5943bce17b964a79)

- Install **nvm** and initialize by reload the shell configuration.

```bash
$ curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.3/install.sh | bash
$ source ~/.bashrc
```

- Verify **nvm** is installed by running:

```bash
$ nvm --version # Your version of nvm may be different

0.35.3
```

If you got the above output, then you are ready to continue with the following steps.

## Install Node.js with nvm

You can read more about install **Node.js** with **nvm** here: [How to install Node.js with NVM](https://gist.github.com/d2s/372b5943bce17b964a79#install-nodejs-with-nvm)

- Install **Node.js** and check to see if it is installed correctly.

```bash
$ nvm install v12.16.3

Downloading and installing node v12.16.3...
Downloading https://nodejs.org/dist/v12.16.3/node-v12.16.3-linux-x64.tar.xz...
################################################################################## 100.0%
Computing checksum with sha256sum
Checksums matched!
Now using node v12.16.3 (npm v6.14.4)
Creating default alias: default -> v12.16.3


$ node -v # Your version of node.js may be different

v12.16.3
```

With **Node.js** installed, you can continue with the installation.

## Install PM2

**PM2** is a tool that helps you manage and keep erxes online. It is a process manager. You can read more about the installation process here: [How to install PM2](https://pm2.keymetrics.io/docs/usage/quick-start/)

- Install **PM2** and check to see if it is installed correctly.

```bash
$ npm install pm2@latest -g

* * *

+ pm2@4.4.0
added 185 packages from 191 contributors in 9.605s

$ pm2 --version

* * *

[PM2] Spawning PM2 daemon with pm2_home=/home/erxes/.pm2
[PM2] PM2 Successfully daemonized
4.4.0 # Your version of pm2 may be different
```

You should receive a response from `pm2 --version`. The version should show as last line. You will need **PM2** later in the installation process. For now, continue on with the next steps to install **Yarn**.

## Yarn install

**Yarn** is a package manager. The alternative is [npm](https://www.npmjs.com/). We recommend [yarn](https://yarnpkg.com/). For additional [yarn installation instructions, read this](https://classic.yarnpkg.com/en/docs/install/#debian-stable).

- Install **yarn** and check to see if it is installed correctly.

```bash
$ curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
[sudo] password for erxes:
OK

$ echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
apt/sources.list.d/yarn.list
deb https://dl.yarnpkg.com/debian/ stable main

$ sudo apt update && sudo apt install --no-install-recommends yarn
Hit:1 http://mirrors.linode.com/ubuntu bionic InRelease
Get:2 http://mirrors.linode.com/ubuntu bionic-updates InRelease [88.7 kB]

* * *

Selecting previously unselected package yarn.
(Reading database ... 102699 files and directories currently installed.)
Preparing to unpack .../archives/yarn_1.22.4-1_all.deb ...
Unpacking yarn (1.22.4-1) ...
Setting up yarn (1.22.4-1) ...

$ yarn --version
1.22.4 # Your version of yarn may be different
```

As long as you received a version response to `yarn --version`, then you can continue and install **MongoDB**.

## Install MongoDB

**MongoDB** is a robust and general purpose document-based database. For additional [MongoDB installation instructions, read this](https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/).

```bash
$ wget -qO - https://www.mongodb.org/static/pgp/server-4.2.asc | sudo apt-key add -
OK

$ echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.2 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-4.2.list
$ sudo apt-get update
Hit:1 http://mirrors.linode.com/ubuntu bionic InRelease
Hit:2 http://mirrors.linode.com/ubuntu bionic-updates InRelease
Reading package lists... Done
Building dependency tree
Reading state information... Done

* * *

Fetched 18.0 kB in 1s (20.1 kB/s)
Reading package lists... Done

$ sudo apt-get install -y mongodb-org


* * *

Adding group `mongodb' (GID 115) ...
Done.
Adding user `mongodb' to group `mongodb' ...
Adding user mongodb to group mongodb
Done.
Setting up mongodb-org (4.2.8) ...
Processing triggers for man-db (2.8.3-2ubuntu0.1) ...


$ sudo systemctl start mongod
$ sudo systemctl enable mongod
Created symlink /etc/systemd/system/multi-user.target.wants/mongod.service → /lib/systemd/system/mongod.service.

$ mongod --version
db version v4.2.8

* * *
```

### Deploy a MongoDB Replica Set

MongoDB [replica sets](https://docs.mongodb.com/manual/reference/glossary/#term-replica-set) add an extra layer of redundancy and help with load balancing. The are a group of **mongod processes** that maintain the same data set. You can read about **replication** [here](https://docs.mongodb.com/manual/replication/).

- Stop the **mongod** processes

```bash
$ sudo systemctl stop mongod
```

- Open **mongod.conf**

```bash
$ sudo nano /etc/mongod.conf
```

- Enable the **replicaset** settings, by searching for `#replication`. Remove the `#` to activate it and edit to include the set name, as follows:

```bash
replication:
  replSetName: rs0
```

- Save and Exit with `<Ctrl> x`
- Verify that the changes were saved.

```bash
$ sudo cat /etc/mongod.conf

* * *

#security:

#operationProfiling:

replication:
  replSetName: rs0

#sharding:

## Enterprise-Only Options:

* * *
```

- Restart mongob

```bash
$ sudo systemctl start mongod
```

- Connect to mongo shell, initialize replicaSet and verify **SECONDARY** changes to **Primary**.

```bash
$ mongo

> rs.initiate()

{
	"info2" : "no configuration specified. Using a default configuration for the set",
	"me" : "127.0.0.1:27017",
	"ok" : 1,
	"$clusterTime" : {
		"clusterTime" : Timestamp(1594140533, 1),
		"signature" : {
			"hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),
			"keyId" : NumberLong(0)
		}
	},
	"operationTime" : Timestamp(1594140533, 1)
}

rs0:SECONDARY>
rs0:PRIMARY> # <----- This is what you are looking for
rs0:PRIMARY> # press `ctrl-c` to quit mongo
bye
```

- press `ctrl-c` to quit mongo

If you were able to return to the command line prompt. Then you may continue with the installation of **Redis**.

## Install Redis

**Redis** is an in memory quick-response database. For additional [Redis installation instructions, read this](https://www.digitalocean.com/community/tutorials/how-to-install-and-secure-redis-on-ubuntu-18-04).

- Install **redis** and check to see if it is installed correctly.

```bash
$ sudo apt-get install -y redis-server
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following additional packages will be installed:
  libjemalloc1 redis-tools

   * * *

$ sudo systemctl status redis
● redis-server.service - Advanced key-value store
   Loaded: loaded (/lib/systemd/system/redis-server.service; enabled; vendor preset: enab
   Active: active (running) since Tue 2020-07-07 17:11:46 UTC; 56s ago

   * * *

   # ctrl+c to quit
```

Providing you got **Active** output for **Redis** you may now continue with the next steps.

## Install RabbitMQ and dependencies

**RabbitMQ** is a message broker. It is used to relay messages to and from two other applications. For additional [RabbitMQ installation instructions, read this](https://www.rabbitmq.com/install-debian.html#apt-packagecloud).

### Install Erlang 22.x

**Erlang** is the programming language that **RabbitMQ** is written in. It must be installed when you install **RabbitMQ**. For additional information about [installing Erlang, read this](https://www.rabbitmq.com/install-debian.html#apt-bintray-erlang).

- Install **Erlang**

```bash
$ curl -fsSL https://github.com/rabbitmq/signing-keys/releases/download/2.0/rabbitmq-release-signing-key.asc | sudo apt-key add -
OK

$ sudo apt-get install apt-transport-https
Reading package lists... Done
Building dependency tree

    * * *

Unpacking apt-transport-https (1.6.12ubuntu0.1) ...
Setting up apt-transport-https (1.6.12ubuntu0.1) ...
```

- Create the `bintray.erlang.list` file and write to the `/etc/apt/sources.list.d` directory.

```bash
$ sudo touch /etc/apt/sources.list.d/bintray.erlang.list
```

- Copy the following text to the `bintray.erlang.list` file.

```txt
# This repository provides Erlang packages produced by the RabbitMQ team
# See below for supported distribution and component values
deb https://dl.bintray.com/rabbitmq-erlang/debian bionic erlang-22.x
```

```bash
$ sudo nano /etc/apt/sources.list.d/bintray.erlang.list

# paste the above text in the file and save with ctrl + x, y
```

- Verify that you have properly added the above text to the proper file.

```bash
$ sudo cat /etc/apt/sources.list.d/bintray.erlang.list
```

- Update and list of `apt` sources

```bash
$ sudo apt-get update -y
Hit:1 http://mirrors.linode.com/ubuntu bionic InRelease

    * * *

Hit:9 https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.2 Release
Fetched 32.6 kB in 1s (45.9 kB/s)
Reading package lists... Done
```

Metapackages such as erlang and erlang-nox must only be used with apt version pinning. They do not pin their dependency versions. The following steps are recommended.

- Install **Erlang** packages.

```bash
$ sudo apt-get install -y erlang-base \
    erlang-asn1 erlang-crypto erlang-eldap erlang-ftp erlang-inets \
    erlang-mnesia erlang-os-mon erlang-parsetools erlang-public-key \
    erlang-runtime-tools erlang-snmp erlang-ssl \
    erlang-syntax-tools erlang-tftp erlang-tools erlang-xmerl
```

- Verify **Erlang** installation

```bash
$ erl

Erlang/OTP 22 [erts-10.7.2.1] [source] [64-bit] [smp:4:4] [ds:4:4:10] [async-threads:1]

Eshell V10.7.2.1  (abort with ^G)
1>    # halt(). to exit

```

- type `halt().` to exit from **Erlang** in the terminal.

You have now installed the dependencies for **RabbitMQ**. Continue with the following steps.

### Install RabbitMQ

The following steps will install RabbitMQ.

- Install **RabbitMQ** by importing a signing key from [PackageCloud](https://packagecloud.io/rabbitmq), add the PackageCloud repo, and **install rabbitmq-server**.

```bash
$ wget -O - "https://packagecloud.io/rabbitmq/rabbitmq-server/gpgkey" | sudo apt-key add -

--2020-07-07 19:18:56--  https://packagecloud.io/rabbitmq/rabbitmq-server/gpgkey
Resolving packagecloud.io (packagecloud.io)... 2600:1f1c:2e5:6900:4977:25fb:37af:af52,

    * * *

2020-07-07 19:18:56 (476 MB/s) - written to stdout [3954/3954]

OK

$ curl -s https://packagecloud.io/install/repositories/rabbitmq/rabbitmq-server/script.deb.sh | sudo bash

Detected operating system as Ubuntu/bionic.
Checking for curl...

    * * *

The repository is setup! You can now install packages.

$ sudo apt-get install -y rabbitmq-server

Reading package lists... Done
Building dependency tree
Reading state information... Done
The following additional packages will be installed:
  socat
The following NEW packages will be installed:
  rabbitmq-server socat

    * * *

Processing triggers for man-db (2.8.3-2ubuntu0.1) ...
Processing triggers for ureadahead (0.100.0-21) ...
Processing triggers for systemd (237-3ubuntu10.41) ...
```

- Enable and start the **RabbitMQ** server

```bash
$ sudo systemctl enable rabbitmq-server

Synchronizing state of rabbitmq-server.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install enable rabbitmq-server

$ sudo systemctl start rabbitmq-server
```

- Verify **RabbitMQ** is properly installed and running.

```bash
$ sudo service rabbitmq-server status

● rabbitmq-server.service - RabbitMQ broker
   Loaded: loaded (/lib/systemd/system/rabbitmq-server.service; enabled; vendor preset: enabled)
   Active: active (running) since Tue 2020-07-07 19:23:42 UTC; 6min ago
 Main PID: 28136 (beam.smp)
   Status: "Initialized"
    Tasks: 91 (limit: 4915)

    * * *

    # exit with ctrl + c
```

- You can exit with `ctrl + c`

If you see and **Active** message, similar to the above, then you are ready to continue and go onto installing **Elasticsearch**.

## Install Elasticsearch

**Elasticsearch** is a search feature that allows you to search for data in real time. For additional [Elasticsearch installation instructions, read this](https://www.elastic.co/guide/en/elasticsearch/reference/current/deb.html).

```bash

$ wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -
OK

$ echo "deb https://artifacts.elastic.co/packages/7.x/apt stable main" | sudo tee -a /etc/apt/sources.list.d/elastic-7.x.list
$ sudo apt-get update && sudo apt-get install elasticsearch

Hit:1 http://mirrors.linode.com/ubuntu bionic InRelease
Hit:2 http://mirrors.linode.com/ubuntu bionic-updates InRelease

    * * *

Unpacking elasticsearch (7.8.0) ...
Setting up elasticsearch (7.8.0) ...
Created elasticsearch keystore in /etc/elasticsearch/elasticsearch.keystore
Processing triggers for ureadahead (0.100.0-21) ...
Processing triggers for systemd (237-3ubuntu10.41) ...

$ sudo /bin/systemctl daemon-reload
$ sudo /bin/systemctl enable elasticsearch.service

Synchronizing state of elasticsearch.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install enable elasticsearch
Created symlink /etc/systemd/system/multi-user.target.wants/elasticsearch.service → /usr/lib/systemd/system/elasticsearch.service.

$ sudo systemctl start elasticsearch.service

# can take a minute
```

- Verify **Elasticsearch** is installed and running installing the following library and test the `GET /` response.

```BASH
$ sudo apt install libwww-perl

Reading package lists... Done
Building dependency tree
Reading state information... Done

    * * *

Do you want to continue? [Y/n] y

Get:1 http://mirrors.linode.com/ubuntu bionic/main amd64 libdata-dump-perl all 1.23-1 [27.0 kB]
Get:2 http://mirrors.linode.com/ubuntu bionic/main amd64 libencode-locale-perl all 1.05-1 [12.3 kB]
Get:3 http://mirrors.linode.com/ubuntu bionic/main amd64 libtimedate-perl all 2.3000-2 [37.5 kB]

    * * *

Setting up liblwp-protocol-https-perl (6.07-2) ...
Setting up libwww-perl (6.31-1ubuntu0.1) ...
Processing triggers for man-db (2.8.3-2ubuntu0.1) ...

$ GET /

<HTML>
<HEAD>
<TITLE>Directory /</TITLE>
<BASE HREF="file:/">
</HEAD>
<BODY>
<H1>Directory listing of /</H1>
<UL>
<LI><A HREF="./">./</A>

    * * *

<LI><A HREF="vmlinuz">vmlinuz</A>
<LI><A HREF="vmlinuz.old">vmlinuz.old</A>
</UL>
</BODY>
</HTML>
```

If the `GET /` outputted the HTML page, similar to the above, then you are ready to configure your **NGINX** proxy server.

## Install and configure NGINX

**NGINX** is a very powerful web server. It is often used as a proxy server for emails. For additional [NGINX installation instructions, read this](https://www.nginx.com/resources/wiki/start/topics/tutorials/install/).

NGINX is installed from the stable repo https://launchpad.net/~nginx/+archive/ubuntu/stable.

```bash
$ sudo add-apt-repository ppa:nginx/stable

 This PPA contains the latest Stable Release version of the nginx web server software.

**Only Non-End-of-Life Ubuntu Releases are supported in this PPA**

**Development releases of Ubuntu are not officially supported by this PPA, and uploads for those will not be available until Beta releases for those versions**
 More info: https://launchpad.net/~nginx/+archive/ubuntu/stable
Press [ENTER] to continue or Ctrl-c to cancel adding it.

    * * *

Hit:15 https://packagecloud.io/rabbitmq/rabbitmq-server/ubuntu bionic InRelease
Fetched 60.9 kB in 1s (57.4 kB/s)
Reading package lists... Done

$ sudo apt-get update

Hit:1 http://mirrors.linode.com/ubuntu bionic InRelease
Hit:2 http://mirrors.linode.com/ubuntu bionic-updates InRelease

    * * *

Fetched 32.6 kB in 1s (28.1 kB/s)
Reading package lists... Done

$ sudo apt-get install -y nginx

Reading package lists... Done
Building dependency tree
Reading state information... Done
The following additional packages will be installed:

    * * *

Rules updated for profile 'OpenSSH'
Skipped reloading firewall
Processing triggers for ureadahead (0.100.0-21) ...
Processing triggers for libc-bin (2.27-3ubuntu1) ...
```

**NGINX** started by default when you installed it. But it is recommended to `enable` and `start` anyway.

```bash
$ sudo systemctl enable nginx

Synchronizing state of nginx.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install enable nginx

$ sudo systemctl start nginx
```

## Configure NGINX

The next step is to configure **NGINX** so that it allows traffic from the firewall. You will be allowing `Ports 80 and 443`.

- Ensure the `ufw` firewall knows about the available applications.

```bash
$ sudo ufw app list

Available applications:
  Nginx Full
  Nginx HTTP
  Nginx HTTPS
  OpenSSH
```

The output should look something like the `Available applications` output above. `Nginx Full` should be listed.

- Enable Port 80 and Port 443 to allow traffic.

```bash
$ sudo ufw allow 'Nginx Full'
Rule added
Rule added (v6)
```

- Verify that `ufw` has been updated.

```bash
$ sudo ufw status

Status: active

To                         Action      From
--                         ------      ----
OpenSSH                    ALLOW       Anywhere
80,443/tcp                 ALLOW       Anywhere
Nginx Full                 ALLOW       Anywhere
OpenSSH (v6)               ALLOW       Anywhere (v6)
80,443/tcp (v6)            ALLOW       Anywhere (v6)
Nginx Full (v6)            ALLOW       Anywhere (v6)
```

Your output should match the above **Status** output.

### Configure NGINX

The next step is to create a server block with the correct directives to work with the erxes installation.

- Below is the **NGINX server block** you need to _copy/paste_ into the file. Replace `YOUR-DOMAIN-COM` with your actual `domain name`.

```txt
server {
        listen 80;

        # your domain name here
        server_name YOUR-DOMAIN-COM;

        # erxes build path
        root /home/erxes/erxes/erxes/ui/build;
        index index.html;

        error_log /var/log/nginx/erxes.error.log;
        access_log /var/log/nginx/erxes.access.log;

        location / {
                try_files $uri /index.html;
        }

        # widgets is running on 3200 port.
        location /widgets/ {
                proxy_pass http://127.0.0.1:3200/;
                proxy_set_header Host $http_host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_http_version 1.1;
        }

        # api project is running on 3300 port.
        location /api/ {
                proxy_pass http://127.0.0.1:3300/;
                # proxy_set_header Host $http_host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_http_version 1.1;
                proxy_set_header Upgrade $http_upgrade;
                # proxy_set_header Connection "Upgrade";
                proxy_set_header Connection 'upgrade';
                proxy_set_header Host $host;
        }
        # erxes integrations project is running on 3400 port.
        location /integrations/ {
                proxy_pass http://127.0.0.1:3400/;
                proxy_set_header Host $http_host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_http_version 1.1;
        }
}
```

- Create a new file in the correct directory, and name it your domain name. For example, if your domain name is `erxes.example.com`, name the file, `erxes.example.com`.

```bash
# example: sudo nano /etc/nginx/sites-available/erxes.example.com
$ sudo nano /etc/nginx/sites-available/YOUR-DOMAIN-NAME

# Copy and paste the above server block and save with ctrl + x
```

- Copy and paste the above server block and save with ctrl + x
- Enable the file by creating a link form it to **sites-enabled**. Make sure to use your domain name exactly as you created the file above.

```bash
$ sudo ln -s /etc/nginx/sites-available/YOUR-DOMAIN-COM /etc/nginx/sites-enabled/
```

- Adjust the nginx.conf and uncomment the following line `server_names_hash_bucket_size 64;`

```bash

$ sudo nano /etc/nginx/nginx.conf
```

It should look like this:

```txt
http {
    * * *
    server_names_hash_bucket_size 64;
    * * *
}
```

- Test the NGINX files to make sure you don't have any errors

```bash
$ sudo nginx -t
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful

```

If you you get no errors, you are ready to install the SSL Certificates using **Let's Encrypt**.

## LETS ENCRYPT

## Install erxes

```

cd ~
mkdir erxes
cd erxes
git clone https://github.com/erxes/erxes.git
git clone https://github.com/erxes/erxes-api.git
git clone https://github.com/erxes/erxes-integrations.git

```

- The following assumes the following URLS. You need to use your own url.

```

localhost:3000 => erxes.acneskindisorder.com
localhost:3200 => erxes.acneskindisorder.com/widgets
localhost: 3300 => erxes.acneskindisorder.com/api
localhost: 3400 => erxes.acneskindisorder.com/integrations

```

### Configure erxes UI

```

cd ~/erxes/erxes/ui
yarn install
cp .env.sample .env

```

- open .env file

```bash
vim .env
```

```
PORT=3000
NODE_ENV=development
REACT_APP_CDN_HOST=http://erxes.acneskindisorder.com/widgets
REACT_APP_API_URL=http://erxes.acneskindisorder.com/api
REACT_APP_API_SUBSCRIPTION_URL=ws://erxes.acneskindisorder.com/api/subscriptions
```

### Configure erxes widgets

```bash
cd ~/erxes/erxes/widgets
yarn install
cp .env.sample .env
vim .env
```

```
PORT=3200
ROOT_URL=http://erxes.acneskindisorder.com/widgets
API_URL=http://erxes.acneskindisorder.com/api
API_SUBSCRIPTIONS_URL=ws://erxes.acneskindisorder.com/api/subscriptions
```

```bash
yarn build
```

### Configure erxes-api/logger

```bash
cd ~/erxes/erxes-api/logger
yarn install
cp .env.sample .env
vim .env
cat .env
```

```
PORT=3800
MONGO_URL=mongodb://localhost/erxes_logs
# RabbitMQ
RABBITMQ_HOST=amqp://localhost
```

[VERIFY THIS]
(# RabbitMQ
RABBITMQ_HOST=amqp://localhost)

```bash
yarn build
```

### Configure erxes-api/email-verifier

```bash
cd ~/erxes/erxes-api/email-verifier
yarn install
cp .env.sample .env

vim .env
```

- change to production

```bash
cat .env
```

- results:

```
NODE_ENV=production
PORT=4100

# MongoDB
MONGO_URL=mongodb://localhost/erxes-email-verifier

# RabbitMQ
RABBITMQ_HOST=amqp://localhost

TRUE_MAIL_API_KEY=

```

```
yarn build
```

### configure erxes-api/engages-email-sender

```
cd ~/erxes/erxes-api/engages-email-sender
yarn install
cp .env.sample .env
vim .env
```

- change to production and add url .../api

```
cat .env
```

- results in

```
# general
NODE_ENV=production
PORT=3900

# public urls
MAIN_API_DOMAIN=http://erxes.acneskindisorder.com/api

# MongoDB
MONGO_URL=mongodb://localhost/erxes-engages
TEST_MONGO_URL=mongodb://localhost/erxes-engages-test

# RabbitMQ
RABBITMQ_HOST=amqp://localhost

# Redis
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

```

```
yarn build
```

### configure erxes-api/elkSyncer

```bash
cd ~/erxes/erxes-api/elkSyncer
curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py
sudo apt-get install python3-distutils

add password erxes123
y to continue

python3 get-pip.py
```

### ~/.bashrc => PATH="$HOME/.local/bin:$PATH"

```
vim ~/.bashrc
```

```
PATH="$HOME/.local/bin:$PATH"
```

- then save

- issue the following in the terminal

```bash
PATH="$HOME/.local/bin:$PATH"
export PATH
```

- install these

```
pip3 install -r requirements.txt
cp .env.sample .env
vim .env
```

- verify with

```
cat .env
```

- results / output

```
MONGO_URL=mongodb://mongo/erxes
ELASTICSEARCH_URL=http://localhost:9200
```

- then build

```
yarn build
```

### configure erxes-api

```
cd ~/erxes/erxes-api
yarn install
cp .env.sample .env
vim .env
```

```
yarn build
```

### configure erxes-integrations

```
cd ~/erxes/erxes-integrations
vim package.json
"node": "10.x.x" => "node": ">=10.x.x"
```

```
yarn install
cp .env.sample .env
vim .env
cat .env
```

- output

```
NODE_ENV=production
PORT=3400
MONGO_URL=mongodb://localhost/erxes_integrations

# Redis

REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# RABBITMQ

RABBITMQ_HOST=amqp://localhost

# public facing domains

DOMAIN=http://erxes.acneskindisorder.com/integrations

# erxes non public domains

MAIN_APP_DOMAIN=http://erxes.acneskindisorder.com
MAIN_API_DOMAIN=http://erxes.acneskindisorder.com/api

```

- then build

```
yarn build
```

### widgets

```
cd ~/erxes/erxes/widgets
pm2 start dist --name widgets
```

### logger

```
cd ~/erxes/erxes-api/logger
pm2 start dist --name logger
```

### email-verifier

```
cd ~/erxes/erxes-api/email-verifier
pm2 start dist --name email-verifier
```

### engages-email-sender

```
cd ~/erxes/erxes-api/engages-email-sender
pm2 start dist --name engages-email-sender
```

### elkSyncer [THIS IS BUGGED. NEEDS TO BE STOPPED]

```
cd ~/erxes/erxes-api/elkSyncer
pm2 start main.py --name elkSyncer --interpreter python3
```

### api

```
cd ~/erxes/erxes-api
pm2 start dist --name erxes-api
pm2 start dist/cronJobs --name erxes-crons
pm2 start dist/workers --name erxes-workers
```

### erxes-integrations

```
cd ~/erxes/erxes-integrations
pm2 start dist --name erxes-integrations
```

### Nginx config

```
sudo vim /etc/nginx/sites-enabled/erxes.conf
```

- copy paste nginx config

```
sudo nginx -t
sudo service nginx reload
```

```
server {
        listen 80;

        server_name erxes.kaidawei.com;

        # erxes build path
        root /home/erxes/erxes/erxes/ui/build;
        index index.html;

        error_log /var/log/nginx/erxes.error.log;
        access_log /var/log/nginx/erxes.access.log;

        location / {
                try_files $uri /index.html;
        }

        # widgets is running on 3200 port.
        location /widgets/ {
                proxy_pass http://127.0.0.1:3200/;
                proxy_set_header Host $http_host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_http_version 1.1;
        }

        # api project is running on 3300 port.
        location /api/ {
                proxy_pass http://127.0.0.1:3300/;
                proxy_set_header Host $http_host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_http_version 1.1;
                proxy_set_header Upgrade $http_upgrade;
                proxy_set_header Connection "Upgrade";
        }
        # erxes integrations project is running on 3400 port.
        location /integrations/ {
                proxy_pass http://127.0.0.1:3400/;
                proxy_set_header Host $http_host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_http_version 1.1;
        }
}
```

- initialize Erxes

```bash
cd ~/erxes/erxes-api
yarn initProject
yarn loadPermission
```

</TabItem>

</Tabs>
