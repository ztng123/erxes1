---
id: ubuntu
title: Ubuntu 18.04
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

## Server Installation Requirements

erxes gives you many options for installing the erxes platform. Below you will find two guides. The first guide is the **Quick Start** guide where we provide a script that automates most of the installation process. The second guide is a comprehensive, **Step by Step** guide where advanced developers can see exactly what is being installed and how.

:::info Ubuntu 18.04
These instructions are for installing erxes on **Ubuntu 18.04**. They should work on any hosting provider that allows you to install Ubuntu 18.04.
:::

### Minimum required server resources

Each hosting company has slightly different server configurations and set-ups. Hosting companies such as [Linode.com](https://www.linode.com/), [Digital Ocean](https://digitalocean.com) and [AWS EC2](https://aws.amazon.com/ec2) offer many different server specifications and configuration options.

To properly install and maintain your erxes installation, the minimum requirements are:

- Ubuntu 18.04 (or other supported Linus distribution)
- 4 cpus
- 8GB RAM
- ability to to SSH into the server

:::tip Use one-click installs
You can also use the [Digital Ocean Marketplace](https://marketplace.digitalocean.com/apps/erxes) and [AWS Marketplace](https://aws.amazon.com/marketplace/pp/B086MZ9FVS?qid=1594055516154&sr=0-1&ref_=srh_res_product_title) for an even easier set-up experience.
:::

### Setting up a server with Ubuntu 18.04

- You must have an account with your hosting provider prior to doing these steps.
- You need to create a server with **Ubuntu 18.04** installed, a minimum of **4cpus** and **8GB RAM**. At this time, erxes needs a minimum of 4 cpus and 8GB RAM to finish installation.

### Configure your DNS Records to point at your server

- Your server will have an ip address. You will need to point your `A records` under the _DNS Editor_ for the domain which will host your erxes installation. The propagation is often reported to take up to 24 hours. Most of the time, propagation of your domain name happens within the hour.

:::note Example with a domain called, example.com

If your domain name is **example.com**, and the **ip address** assigned to your server is **44.123.32.12**, then you will have two `A records` that look like this:

| Type | Name            | Value                  |
| ---- | --------------- | ---------------------- |
| A    | www.example.com | points to 44.123.32.12 |

:::

:::note Example with a subdomain called, erxes.example.com

If your domain name is **erxes.example.com**, and the **ip address** assigned to your server is **44.123.32.12**, then you will have two `A records` that look like this:

| Type | Name              | Value                  |
| ---- | ----------------- | ---------------------- |
| A    | erxes.example.com | points to 44.123.32.12 |

**Note:** You do not need to create a subdomain named "erxes.example.com", you can use another name of your choice such as "admin.example.com".
:::

<Tabs
  defaultValue='step-by-step'
  values={[
    { label: 'Quickstart', value: 'quickstart' },
    { label: 'Step by Step', value: 'step-by-step' },
]}>

<TabItem value='quickstart'>

## Installing erxes on Ubuntu 18.04

You can simply follow [Debian doc](/installation/debian10) to install manually.

</TabItem>
<TabItem value='step-by-step'>

## Log into server as root and create erxes user

- Open the terminal or command prompt on your computer. (You will need your **IP address**. In the above example, **44.123.32.12**).

```bash
$ # example ssh root@44.123.32.12
$ ssh root@your-ip-address

    The authenticity of host '44.123.32.12 (44.123.32.12)' can't be established.
    ECDSA key fingerprint is SHA256:RbrZOxtr/emNySeNd8rh2C9VPGY76JbSs1Dhpvfkfrk.
    Are you sure you want to continue connecting (yes/no/[fingerprint])?

$ Yes

    Warning: Permanently added '44.123.32.12' (ECDSA) to the list of known hosts.
    Welcome to Ubuntu 18.04.4 LTS (GNU/Linux 4.15.0-101-generic x86_64)
```

- Add a user called, "erxes" and grant that user administrative access rights

You don't want to use the **root** user to administer your server. So everything will be done by a user called, **erxes**. To accomplish this run the following commands. They will add a user called **erxes**, give it a password and assign administrative access rights.

```bash
$ adduser erxes

    Adding user `erxes' ...
    Adding new group `erxes' (1000) ...
    Adding new user `erxes' (1000) with group `erxes' ...
    Creating home directory `/home/erxes' ...
    Copying files from `/etc/skel' ...

$ Enter new UNIX password: erxes123
$ Retype new UNIX password: erxes123

    passwd: password updated successfully
    Changing the user information for erxes
    Enter the new value, or press ENTER for the default

    	Full Name []:
        Room Number []:
        Work Phone []:
        Home Phone []:
        Other []:

$ Is the information correct? [Y/n] y

$ usermod -aG sudo erxes
```

## Set-up a basic firewall for SSH, nginx 80 and port 443

- Allow OpenSSH, enable it and check the status. OpenSSH will use **port 22**.

```bash

$ ufw allow OpenSSH

    Rules updated
    Rules updated (v6)

$ ufw enable
$ Command may disrupt existing ssh connections. Proceed with operation (y|n)? y

    Firewall is active and enabled on system startup


$ ufw status

Status: active

To                         Action      From
--                         ------      ----
OpenSSH                    ALLOW       Anywhere
OpenSSH (v6)               ALLOW       Anywhere (v6)

```

Your output should like something like the above.

-- Open port 80 (for NGINX) and open port 443. Port 80 allows **http** traffic and port 443 allows **https** traffic.

```bash

$ ufw allow proto tcp from any to any port 80,443

Rule added
Rule added (v6)

$ Command may disrupt existing ssh connections. Proceed with operation (y|n)? y

Firewall is active and enabled on system startup

$ ufw status

Status: active

To                         Action      From
--                         ------      ----
OpenSSH                    ALLOW       Anywhere
80,443/tcp                 ALLOW       Anywhere
OpenSSH (v6)               ALLOW       Anywhere (v6)
80,443/tcp (v6)            ALLOW       Anywhere (v6)

```

- Exit from server, so that you can log back in as **erxes**

```bash
$ exit

logout
Connection to 44.123.32.12 closed.
```

- Log back into the server as the **erxes** user and provide the password

```bash
$ ssh erxes@44.123.32.12
$ erxes@45.79.248.46's password:

Welcome to Ubuntu 18.04.4 LTS (GNU/Linux 4.15.0-101-generic x86_64)
```

In the following section, you will install software dependencies that are needed to run erxes. You will also need to install various tools that will help to administer your server or install the packages themselves.

## Nvm install

**Node Version Manage (nvm)** is a tool that allows you to download and install [Node.js](https://nodejs.org/). You can read more about the installation process here: [How to install NVM](https://gist.github.com/d2s/372b5943bce17b964a79)

- Install **nvm** and initialize by reload the shell configuration.

```bash
$ curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.3/install.sh | bash
$ source ~/.bashrc
```

- Verify **nvm** is installed by running:

```bash
$ nvm --version # Your version of nvm may be different

0.35.3
```

If you got the above output, then you are ready to continue with the following steps.

## Install Node.js with nvm

You can read more about install **Node.js** with **nvm** here: [How to install Node.js with NVM](https://gist.github.com/d2s/372b5943bce17b964a79#install-nodejs-with-nvm)

- Install **Node.js** and check to see if it is installed correctly.

```bash
$ nvm install v12.16.3

Downloading and installing node v12.16.3...
Downloading https://nodejs.org/dist/v12.16.3/node-v12.16.3-linux-x64.tar.xz...
################################################################################## 100.0%
Computing checksum with sha256sum
Checksums matched!
Now using node v12.16.3 (npm v6.14.4)
Creating default alias: default -> v12.16.3


$ node -v # Your version of node.js may be different

v12.16.3
```

With **Node.js** installed, you can continue with the installation.

## Install PM2

**PM2** is a tool that helps you manage and keep erxes online. It is a process manager. You can read more about the installation process here: [How to install PM2](https://pm2.keymetrics.io/docs/usage/quick-start/)

- Install **PM2** and check to see if it is installed correctly.

```bash
$ npm install pm2@latest -g

* * *

+ pm2@4.4.0
added 185 packages from 191 contributors in 9.605s

$ pm2 --version

* * *

[PM2] Spawning PM2 daemon with pm2_home=/home/erxes/.pm2
[PM2] PM2 Successfully daemonized
4.4.0 # Your version of pm2 may be different
```

You should receive a response from `pm2 --version`. The version should show as last line. You will need **PM2** later in the installation process. For now, continue on with the next steps to install **Yarn**.

## Yarn install

**Yarn** is a package manager. The alternative is [npm](https://www.npmjs.com/). We recommend [yarn](https://yarnpkg.com/). For additional [yarn installation instructions, read this](https://classic.yarnpkg.com/en/docs/install/#debian-stable).

- Install **yarn** and check to see if it is installed correctly.

```bash
$ curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
[sudo] password for erxes:
OK

$ echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
apt/sources.list.d/yarn.list
deb https://dl.yarnpkg.com/debian/ stable main

$ sudo apt update && sudo apt install --no-install-recommends yarn
Hit:1 http://mirrors.linode.com/ubuntu bionic InRelease
Get:2 http://mirrors.linode.com/ubuntu bionic-updates InRelease [88.7 kB]

* * *

Selecting previously unselected package yarn.
(Reading database ... 102699 files and directories currently installed.)
Preparing to unpack .../archives/yarn_1.22.4-1_all.deb ...
Unpacking yarn (1.22.4-1) ...
Setting up yarn (1.22.4-1) ...

$ yarn --version
1.22.4 # Your version of yarn may be different
```

As long as you received a version response to `yarn --version`, then you can continue and install **MongoDB**.

## Install MongoDB

**MongoDB** is a robust and general purpose document-based database. For additional [MongoDB installation instructions, read this](https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/).

```bash
$ wget -qO - https://www.mongodb.org/static/pgp/server-4.2.asc | sudo apt-key add -
OK

$ echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.2 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-4.2.list
$ sudo apt-get update
Hit:1 http://mirrors.linode.com/ubuntu bionic InRelease
Hit:2 http://mirrors.linode.com/ubuntu bionic-updates InRelease
Reading package lists... Done
Building dependency tree
Reading state information... Done

* * *

Fetched 18.0 kB in 1s (20.1 kB/s)
Reading package lists... Done

$ sudo apt-get install -y mongodb-org


* * *

Adding group `mongodb' (GID 115) ...
Done.
Adding user `mongodb' to group `mongodb' ...
Adding user mongodb to group mongodb
Done.
Setting up mongodb-org (4.2.8) ...
Processing triggers for man-db (2.8.3-2ubuntu0.1) ...


$ sudo systemctl start mongod
$ sudo systemctl enable mongod
Created symlink /etc/systemd/system/multi-user.target.wants/mongod.service → /lib/systemd/system/mongod.service.

$ mongod --version
db version v4.2.8

* * *
```

### Deploy a MongoDB Replica Set

MongoDB [replica sets](https://docs.mongodb.com/manual/reference/glossary/#term-replica-set) add an extra layer of redundancy and help with load balancing. The are a group of **mongod processes** that maintain the same data set. You can read about **replication** [here](https://docs.mongodb.com/manual/replication/).

- Stop the **mongod** processes

```bash
$ sudo systemctl stop mongod
```

- Open **mongod.conf**

```bash
$ sudo nano /etc/mongod.conf
```

- Enable the **replicaset** settings, by searching for `#replication`. Remove the `#` to activate it and edit to include the set name, as follows:

```bash
replication:
  replSetName: rs0
```

- Save and Exit with `<Ctrl> x`
- Verify that the changes were saved.

```bash
$ sudo cat /etc/mongod.conf

* * *

#security:

#operationProfiling:

replication:
  replSetName: rs0

#sharding:

## Enterprise-Only Options:

* * *
```

- Restart mongob

```bash
$ sudo systemctl start mongod
```

- Connect to mongo shell, initialize replicaSet and verify **SECONDARY** changes to **Primary**.

```bash
$ mongo

> rs.initiate()

{
	"info2" : "no configuration specified. Using a default configuration for the set",
	"me" : "127.0.0.1:27017",
	"ok" : 1,
	"$clusterTime" : {
		"clusterTime" : Timestamp(1594140533, 1),
		"signature" : {
			"hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),
			"keyId" : NumberLong(0)
		}
	},
	"operationTime" : Timestamp(1594140533, 1)
}

rs0:SECONDARY>
rs0:PRIMARY> # <----- This is what you are looking for
rs0:PRIMARY> # press `ctrl-c` to quit mongo
bye
```

- press `ctrl-c` to quit mongo

If you were able to return to the command line prompt. Then you may continue with the installation of **Redis**.

## Install Redis

**Redis** is an in memory quick-response database. For additional [Redis installation instructions, read this](https://www.digitalocean.com/community/tutorials/how-to-install-and-secure-redis-on-ubuntu-18-04).

- Install **redis** and check to see if it is installed correctly.

```bash
$ sudo apt-get install -y redis-server
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following additional packages will be installed:
  libjemalloc1 redis-tools

   * * *

$ sudo systemctl status redis
● redis-server.service - Advanced key-value store
   Loaded: loaded (/lib/systemd/system/redis-server.service; enabled; vendor preset: enab
   Active: active (running) since Tue 2020-07-07 17:11:46 UTC; 56s ago

   * * *

   # ctrl+c to quit
```

Providing you got **Active** output for **Redis** you may now continue with the next steps.

## Install RabbitMQ and dependencies

**RabbitMQ** is a message broker. It is used to relay messages to and from two other applications. For additional [RabbitMQ installation instructions, read this](https://www.rabbitmq.com/install-debian.html#apt-packagecloud).

### Install Erlang 22.x

**Erlang** is the programming language that **RabbitMQ** is written in. It must be installed when you install **RabbitMQ**. For additional information about [installing Erlang, read this](https://www.rabbitmq.com/install-debian.html#apt-bintray-erlang).

- Install **Erlang**

```bash
$ curl -fsSL https://github.com/rabbitmq/signing-keys/releases/download/2.0/rabbitmq-release-signing-key.asc | sudo apt-key add -
OK

$ sudo apt-get install apt-transport-https
Reading package lists... Done
Building dependency tree

    * * *

Unpacking apt-transport-https (1.6.12ubuntu0.1) ...
Setting up apt-transport-https (1.6.12ubuntu0.1) ...
```

- Create the `bintray.erlang.list` file and write to the `/etc/apt/sources.list.d` directory.

```bash
$ sudo touch /etc/apt/sources.list.d/bintray.erlang.list
```

- Copy the following text to the `bintray.erlang.list` file.

```txt
# This repository provides Erlang packages produced by the RabbitMQ team
# See below for supported distribution and component values
deb https://dl.bintray.com/rabbitmq-erlang/debian bionic erlang-22.x
```

```bash
$ sudo nano /etc/apt/sources.list.d/bintray.erlang.list

# paste the above text in the file and save with ctrl + x, y
```

- Verify that you have properly added the above text to the proper file.

```bash
$ sudo cat /etc/apt/sources.list.d/bintray.erlang.list
```

- Update and list of `apt` sources

```bash
$ sudo apt-get update -y
Hit:1 http://mirrors.linode.com/ubuntu bionic InRelease

    * * *

Hit:9 https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.2 Release
Fetched 32.6 kB in 1s (45.9 kB/s)
Reading package lists... Done
```

Metapackages such as erlang and erlang-nox must only be used with apt version pinning. They do not pin their dependency versions. The following steps are recommended.

- Install **Erlang** packages.

```bash
$ sudo apt-get install -y erlang-base \
    erlang-asn1 erlang-crypto erlang-eldap erlang-ftp erlang-inets \
    erlang-mnesia erlang-os-mon erlang-parsetools erlang-public-key \
    erlang-runtime-tools erlang-snmp erlang-ssl \
    erlang-syntax-tools erlang-tftp erlang-tools erlang-xmerl
```

- Verify **Erlang** installation

```bash
$ erl

Erlang/OTP 22 [erts-10.7.2.1] [source] [64-bit] [smp:4:4] [ds:4:4:10] [async-threads:1]

Eshell V10.7.2.1  (abort with ^G)
1>    # halt(). to exit

```

- type `halt().` to exit from **Erlang** in the terminal.

You have now installed the dependencies for **RabbitMQ**. Continue with the following steps.

### Install RabbitMQ

The following steps will install RabbitMQ.

- Install **RabbitMQ** by importing a signing key from [PackageCloud](https://packagecloud.io/rabbitmq), add the PackageCloud repo, and **install rabbitmq-server**.

```bash
$ wget -O - "https://packagecloud.io/rabbitmq/rabbitmq-server/gpgkey" | sudo apt-key add -

--2020-07-07 19:18:56--  https://packagecloud.io/rabbitmq/rabbitmq-server/gpgkey
Resolving packagecloud.io (packagecloud.io)... 2600:1f1c:2e5:6900:4977:25fb:37af:af52,

    * * *

2020-07-07 19:18:56 (476 MB/s) - written to stdout [3954/3954]

OK

$ curl -s https://packagecloud.io/install/repositories/rabbitmq/rabbitmq-server/script.deb.sh | sudo bash

Detected operating system as Ubuntu/bionic.
Checking for curl...

    * * *

The repository is setup! You can now install packages.

$ sudo apt-get install -y rabbitmq-server

Reading package lists... Done
Building dependency tree
Reading state information... Done
The following additional packages will be installed:
  socat
The following NEW packages will be installed:
  rabbitmq-server socat

    * * *

Processing triggers for man-db (2.8.3-2ubuntu0.1) ...
Processing triggers for ureadahead (0.100.0-21) ...
Processing triggers for systemd (237-3ubuntu10.41) ...
```

- Enable and start the **RabbitMQ** server

```bash
$ sudo systemctl enable rabbitmq-server

Synchronizing state of rabbitmq-server.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install enable rabbitmq-server

$ sudo systemctl start rabbitmq-server
```

- Verify **RabbitMQ** is properly installed and running.

```bash
$ sudo service rabbitmq-server status

● rabbitmq-server.service - RabbitMQ broker
   Loaded: loaded (/lib/systemd/system/rabbitmq-server.service; enabled; vendor preset: enabled)
   Active: active (running) since Tue 2020-07-07 19:23:42 UTC; 6min ago
 Main PID: 28136 (beam.smp)
   Status: "Initialized"
    Tasks: 91 (limit: 4915)

    * * *

    # exit with ctrl + c
```

- You can exit with `ctrl + c`

If you see and **Active** message, similar to the above, then you are ready to continue and go onto installing **Elasticsearch**.

## Install Elasticsearch

**Elasticsearch** is a search feature that allows you to search for data in real time. For additional [Elasticsearch installation instructions, read this](https://www.elastic.co/guide/en/elasticsearch/reference/current/deb.html).

```bash

$ wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -
OK

$ echo "deb https://artifacts.elastic.co/packages/7.x/apt stable main" | sudo tee -a /etc/apt/sources.list.d/elastic-7.x.list
$ sudo apt-get update && sudo apt-get install elasticsearch

Hit:1 http://mirrors.linode.com/ubuntu bionic InRelease
Hit:2 http://mirrors.linode.com/ubuntu bionic-updates InRelease

    * * *

Unpacking elasticsearch (7.8.0) ...
Setting up elasticsearch (7.8.0) ...
Created elasticsearch keystore in /etc/elasticsearch/elasticsearch.keystore
Processing triggers for ureadahead (0.100.0-21) ...
Processing triggers for systemd (237-3ubuntu10.41) ...

$ sudo /bin/systemctl daemon-reload
$ sudo /bin/systemctl enable elasticsearch.service

Synchronizing state of elasticsearch.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install enable elasticsearch
Created symlink /etc/systemd/system/multi-user.target.wants/elasticsearch.service → /usr/lib/systemd/system/elasticsearch.service.

$ sudo systemctl start elasticsearch.service

# can take a minute
```

- Verify **Elasticsearch** is installed and running installing the following library and test the `GET /` response.

```BASH
$ sudo apt install libwww-perl

Reading package lists... Done
Building dependency tree
Reading state information... Done

    * * *

Do you want to continue? [Y/n] y

Get:1 http://mirrors.linode.com/ubuntu bionic/main amd64 libdata-dump-perl all 1.23-1 [27.0 kB]
Get:2 http://mirrors.linode.com/ubuntu bionic/main amd64 libencode-locale-perl all 1.05-1 [12.3 kB]
Get:3 http://mirrors.linode.com/ubuntu bionic/main amd64 libtimedate-perl all 2.3000-2 [37.5 kB]

    * * *

Setting up liblwp-protocol-https-perl (6.07-2) ...
Setting up libwww-perl (6.31-1ubuntu0.1) ...
Processing triggers for man-db (2.8.3-2ubuntu0.1) ...

$ GET /

<HTML>
<HEAD>
<TITLE>Directory /</TITLE>
<BASE HREF="file:/">
</HEAD>
<BODY>
<H1>Directory listing of /</H1>
<UL>
<LI><A HREF="./">./</A>

    * * *

<LI><A HREF="vmlinuz">vmlinuz</A>
<LI><A HREF="vmlinuz.old">vmlinuz.old</A>
</UL>
</BODY>
</HTML>
```

If the `GET /` outputted the HTML page, similar to the above, then you are ready to configure your **NGINX** proxy server.

## Install and configure NGINX

**NGINX** is a very powerful web server. It is often used as a proxy server for emails. For additional [NGINX installation instructions, read this](https://www.nginx.com/resources/wiki/start/topics/tutorials/install/).

NGINX is installed from the stable repo https://launchpad.net/~nginx/+archive/ubuntu/stable.

```bash
$ sudo add-apt-repository ppa:nginx/stable

 This PPA contains the latest Stable Release version of the nginx web server software.

**Only Non-End-of-Life Ubuntu Releases are supported in this PPA**

**Development releases of Ubuntu are not officially supported by this PPA, and uploads for those will not be available until Beta releases for those versions**
 More info: https://launchpad.net/~nginx/+archive/ubuntu/stable
Press [ENTER] to continue or Ctrl-c to cancel adding it.

    * * *

Hit:15 https://packagecloud.io/rabbitmq/rabbitmq-server/ubuntu bionic InRelease
Fetched 60.9 kB in 1s (57.4 kB/s)
Reading package lists... Done

$ sudo apt-get update

Hit:1 http://mirrors.linode.com/ubuntu bionic InRelease
Hit:2 http://mirrors.linode.com/ubuntu bionic-updates InRelease

    * * *

Fetched 32.6 kB in 1s (28.1 kB/s)
Reading package lists... Done

$ sudo apt-get install -y nginx

Reading package lists... Done
Building dependency tree
Reading state information... Done
The following additional packages will be installed:

    * * *

Rules updated for profile 'OpenSSH'
Skipped reloading firewall
Processing triggers for ureadahead (0.100.0-21) ...
Processing triggers for libc-bin (2.27-3ubuntu1) ...
```

**NGINX** started by default when you installed it. But it is recommended to `enable` and `start` anyway.

```bash
$ sudo systemctl enable nginx

Synchronizing state of nginx.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install enable nginx

$ sudo systemctl start nginx
```

## Configure NGINX

The next step is to configure **NGINX** so that it allows traffic from the firewall. You will be allowing `Ports 80 and 443`.

- Ensure the `ufw` firewall knows about the available applications.

```bash
$ sudo ufw app list

Available applications:
  Nginx Full
  Nginx HTTP
  Nginx HTTPS
  OpenSSH
```

The output should look something like the `Available applications` output above. `Nginx Full` should be listed.

- Enable Port 80 and Port 443 to allow traffic.

```bash
$ sudo ufw allow 'Nginx Full'
Rule added
Rule added (v6)
```

- Verify that `ufw` has been updated.

```bash
$ sudo ufw status

Status: active

To                         Action      From
--                         ------      ----
OpenSSH                    ALLOW       Anywhere
80,443/tcp                 ALLOW       Anywhere
Nginx Full                 ALLOW       Anywhere
OpenSSH (v6)               ALLOW       Anywhere (v6)
80,443/tcp (v6)            ALLOW       Anywhere (v6)
Nginx Full (v6)            ALLOW       Anywhere (v6)
```

Your output should match the above **Status** output.

### Configure NGINX

The next step is to create a server block with the correct directives to work with the erxes installation.

- Below is the **NGINX server block** you need to _copy/paste_ into the file. Replace `YOUR_DOMAIN_COM` with your actual `domain name`.

```txt
server {
        listen 80;

        # your domain name here
        server_name YOUR_DOMAIN_COM;

        # erxes build path
        root /home/erxes/erxes.io/erxes/build;
        index index.html;

        error_log /var/log/nginx/erxes.error.log;
        access_log /var/log/nginx/erxes.access.log;

        location / {
                try_files $uri /index.html;
        }

        # widgets is running on 3200 port.
        location /widgets/ {
                proxy_pass http://127.0.0.1:3200/;
                proxy_set_header Host $http_host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_http_version 1.1;
        }

        # api project is running on 3300 port.
        location /api/ {
                proxy_pass http://127.0.0.1:3300/;
                # proxy_set_header Host $http_host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_http_version 1.1;
                proxy_set_header Upgrade $http_upgrade;
                # proxy_set_header Connection "Upgrade";
                proxy_set_header Connection 'upgrade';
                proxy_set_header Host $host;
        }
        # erxes integrations project is running on 3400 port.
        location /integrations/ {
                proxy_pass http://127.0.0.1:3400/;
                proxy_set_header Host $http_host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_http_version 1.1;
        }
}
```

- Create a new file in the correct directory, and name it your domain name. For example, if your domain name is `erxes.example.com`, name the file, `erxes.example.com`.

```bash
# example: sudo nano /etc/nginx/sites-available/erxes.example.com
$ sudo nano /etc/nginx/sites-available/YOUR-DOMAIN-NAME

# Copy and paste the above server block and save with ctrl + x
```

- Copy and paste the above server block and save with ctrl + x
- Enable the file by creating a link form it to **sites-enabled**. Make sure to use your domain name exactly as you created the file above.

```bash
$ sudo ln -s /etc/nginx/sites-available/YOUR_DOMAIN_COM /etc/nginx/sites-enabled/
```

- Adjust the nginx.conf and uncomment the following line `server_names_hash_bucket_size 64;`

```bash

$ sudo nano /etc/nginx/nginx.conf
```

It should look like this:

```txt
http {
    * * *
    server_names_hash_bucket_size 64;
    * * *
}
```

- Test the NGINX files to make sure you don't have any errors

```bash
$ sudo nginx -t
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful

```

If you you get no errors, you are ready to install the SSL Certificates using **Let's Encrypt** and **Certbot**.

## Install Let's Encrypt using Certbot

**Let's Encrypt** enables you to use **HTTPS** on your website. It will issue you a certificate which shows that you control your domain. [Let's Encrypt additional information](https://www.nginx.com/resources/wiki/start/topics/tutorials/install/).

You will follow the installation instructions as covered [here](https://certbot.eff.org/lets-encrypt/ubuntubionic-nginx), with [Certbot](https://certbot.eff.org/)

- You will need to add a **Certbot** PPA to the list of repositories on the server.

```bash
$ sudo apt-get update
Hit:1 http://mirrors.linode.com/ubuntu bionic InRelease
Hit:2 http://mirrors.linode.com/ubuntu bionic-updates InRelease

    * * *

Get:11 http://security.ubuntu.com/ubuntu bionic-security InRelease [88.7 kB]
Hit:13 https://packagecloud.io/rabbitmq/rabbitmq-server/ubuntu bionic InRelease
Fetched 121 kB in 1s (84.4 kB/s)
Reading package lists... Done

$ sudo apt-get -y install software-properties-common

Reading package lists... Done
Building dependency tree
Reading state information... Done
The following additional packages will be installed:
python3-software-properties

    * * *

Processing triggers for dbus (1.12.2-1ubuntu1.1) ...
Processing triggers for man-db (2.8.3-2ubuntu0.1) ...

$ sudo add-apt-repository universe

'universe' distribution component enabled for all sources.
Hit:1 http://mirrors.linode.com/ubuntu bionic InRelease
Hit:2 http://mirrors.linode.com/ubuntu bionic-updates InRelease
Hit:3 http://mirrors.linode.com/ubuntu bionic-backports InRelease
Hit:4 http://ppa.launchpad.net/nginx/stable/ubuntu bionic InRelease
Hit:5 https://artifacts.elastic.co/packages/7.x/apt stable InRelease
Ign:6 https://dl.bintray.com/rabbitmq-erlang/debian bionic InRelease
Hit:7 https://dl.yarnpkg.com/debian stable InRelease
Get:8 https://dl.bintray.com/rabbitmq-erlang/debian bionic Release [32.6 kB]
Hit:9 http://security.ubuntu.com/ubuntu bionic-security InRelease
Ign:10 https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.2 InRelease
Hit:11 https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.2 Release
Get:12 http://archive.ubuntu.com/ubuntu bionic InRelease [242 kB]
Get:16 http://archive.ubuntu.com/ubuntu bionic/universe i386 Packages [8531 kB]
Hit:13 https://packagecloud.io/rabbitmq/rabbitmq-server/ubuntu bionic InRelease
Get:17 http://archive.ubuntu.com/ubuntu bionic/universe amd64 Packages [8570 kB]
Get:18 http://archive.ubuntu.com/ubuntu bionic/universe Translation-en [4941 kB]
Fetched 22.3 MB in 6s (3800 kB/s)
Reading package lists... Done
W: Skipping acquire of configured file 'erlang-22.x/i18n/Translation-en' as repository 'https://dl.bintray.com/rabbitmq-erlang/debian bionic InRelease' doesn't have the component 'erlang-22.x' (component misspelt in sources.list?)
W: Skipping acquire of configured file 'erlang-22.x/cnf/Commands-amd64' as repository 'https://dl.bintray.com/rabbitmq-erlang/debian bionic InRelease' doesn't have the component 'erlang-22.x' (component misspelt in sources.list?)

sudo add-apt-repository -y ppa:certbot/certbot

Hit:1 http://mirrors.linode.com/ubuntu bionic InRelease
Hit:2 http://mirrors.linode.com/ubuntu bionic-updates InRelease
Hit:3 http://mirrors.linode.com/ubuntu bionic-backports InRelease
Hit:4 https://artifacts.elastic.co/packages/7.x/apt stable InRelease
Ign:5 https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.2 InRelease
Hit:6 https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.2 Release
Ign:7 https://dl.bintray.com/rabbitmq-erlang/debian bionic InRelease
Hit:8 http://security.ubuntu.com/ubuntu bionic-security InRelease
Hit:9 https://dl.yarnpkg.com/debian stable InRelease
Get:10 https://dl.bintray.com/rabbitmq-erlang/debian bionic Release [32.6 kB]
Get:11 http://ppa.launchpad.net/certbot/certbot/ubuntu bionic InRelease [21.3 kB]
Hit:12 http://ppa.launchpad.net/nginx/stable/ubuntu bionic InRelease
Hit:13 http://archive.ubuntu.com/ubuntu bionic InRelease
Hit:15 https://packagecloud.io/rabbitmq/rabbitmq-server/ubuntu bionic InRelease
Get:17 http://ppa.launchpad.net/certbot/certbot/ubuntu bionic/main i386 Packages [8028 B]
Get:18 http://ppa.launchpad.net/certbot/certbot/ubuntu bionic/main amd64 Packages [8032 B]
Get:19 http://ppa.launchpad.net/certbot/certbot/ubuntu bionic/main Translation-en [4176 B]
Fetched 74.1 kB in 1s (57.4 kB/s)
Reading package lists... Done
W: Skipping acquire of configured file 'erlang-22.x/i18n/Translation-en' as repository 'https://dl.bintray.com/rabbitmq-erlang/debian bionic InRelease' doesn't have the component 'erlang-22.x' (component misspelt in sources.list?)
W: Skipping acquire of configured file 'erlang-22.x/cnf/Commands-amd64' as repository 'https://dl.bintray.com/rabbitmq-erlang/debian bionic InRelease' doesn't have the component 'erlang-22.x' (component misspelt in sources.list?)

sudo apt-get update

Hit:1 http://mirrors.linode.com/ubuntu bionic InRelease
Hit:2 http://mirrors.linode.com/ubuntu bionic-updates InRelease
Hit:3 http://mirrors.linode.com/ubuntu bionic-backports InRelease
Hit:4 https://artifacts.elastic.co/packages/7.x/apt stable InRelease
Ign:5 https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.2 InRelease
Ign:6 https://dl.bintray.com/rabbitmq-erlang/debian bionic InRelease
Hit:7 https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.2 Release
Get:8 https://dl.bintray.com/rabbitmq-erlang/debian bionic Release [32.6 kB]
Hit:9 http://security.ubuntu.com/ubuntu bionic-security InRelease
Hit:10 http://ppa.launchpad.net/certbot/certbot/ubuntu bionic InRelease
Hit:11 https://dl.yarnpkg.com/debian stable InRelease
Hit:12 http://ppa.launchpad.net/nginx/stable/ubuntu bionic InRelease
Hit:13 http://archive.ubuntu.com/ubuntu bionic InRelease
Hit:16 https://packagecloud.io/rabbitmq/rabbitmq-server/ubuntu bionic InRelease
Fetched 32.6 kB in 1s (22.5 kB/s)
Reading package lists... Done
W: Skipping acquire of configured file 'erlang-22.x/i18n/Translation-en' as repository 'https://dl.bintray.com/rabbitmq-erlang/debian bionic InRelease' doesn't have the component 'erlang-22.x' (component misspelt in sources.list?)
W: Skipping acquire of configured file 'erlang-22.x/cnf/Commands-amd64' as repository 'https://dl.bintray.com/rabbitmq-erlang/debian bionic InRelease' doesn't have the component 'erlang-22.x' (component misspelt in sources.list?)

```

Install Certbot
Run this command on the command line on the machine to install Certbot.

```bash
$ sudo apt-get install -y certbot python3-certbot-nginx
```

```bash
$ sudo certbot --nginx

Saving debug log to /var/log/letsencrypt/letsencrypt.log
Plugins selected: Authenticator nginx, Installer nginx
Enter email address (used for urgent renewal and security notices) (Enter 'c' to
cancel): david@acneskindisorder.com

---

Please read the Terms of Service at
https://letsencrypt.org/documents/LE-SA-v1.2-November-15-2017.pdf. You must
agree in order to register with the ACME server at
https://acme-v02.api.letsencrypt.org/directory

---

(A)gree/(C)ancel: A

---

Would you be willing to share your email address with the Electronic Frontier
Foundation, a founding partner of the Let's Encrypt project and the non-profit
organization that develops Certbot? We'd like to send you email about our work
encrypting the web, EFF news, campaigns, and ways to support digital freedom.

---

(Y)es/(N)o: Y

Which names would you like to activate HTTPS for?

---

1: erxes.acneskindisorder.com

---

Select the appropriate numbers separated by commas and/or spaces, or leave input
blank to select all options shown (Enter 'c' to cancel): 1
Obtaining a new certificate
Performing the following challenges:
http-01 challenge for erxes.acneskindisorder.com
Waiting for verification...
Cleaning up challenges
Deploying Certificate to VirtualHost /etc/nginx/sites-enabled/erxes.acneskindisorder.com

Please choose whether or not to redirect HTTP traffic to HTTPS, removing HTTP access.

---

1: No redirect - Make no further changes to the webserver configuration.
2: Redirect - Make all requests redirect to secure HTTPS access. Choose this for
new sites, or if you're confident your site works on HTTPS. You can undo this
change by editing your web server's configuration.

---

Select the appropriate number [1-2] then [enter] (press 'c' to cancel): 2
Redirecting all traffic on port 80 to ssl in /etc/nginx/sites-enabled/erxes.acneskindisorder.com

---

Congratulations! You have successfully enabled
https://erxes.acneskindisorder.com

You should test your configuration at:
https://www.ssllabs.com/ssltest/analyze.html?d=erxes.acneskindisorder.com

---

IMPORTANT NOTES:

- Congratulations! Your certificate and chain have been saved at:
  /etc/letsencrypt/live/erxes.acneskindisorder.com/fullchain.pem
  Your key file has been saved at:
  /etc/letsencrypt/live/erxes.acneskindisorder.com/privkey.pem
  Your cert will expire on 2020-10-05. To obtain a new or tweaked
  version of this certificate in the future, simply run certbot again
  with the "certonly" option. To non-interactively renew _all_ of
  your certificates, run "certbot renew"
- Your account credentials have been saved in your Certbot
  configuration directory at /etc/letsencrypt. You should make a
  secure backup of this folder now. This configuration directory will
  also contain certificates and private keys obtained by Certbot so
  making regular backups of this folder is ideal.
- If you like Certbot, please consider supporting our work by:

  Donating to ISRG / Let's Encrypt: https://letsencrypt.org/donate
  Donating to EFF: https://eff.org/donate-le

Test automatic renewal

$ sudo certbot renew --dry-run

Saving debug log to /var/log/letsencrypt/letsencrypt.log

---

Processing /etc/letsencrypt/renewal/erxes.acneskindisorder.com.conf

---

Cert not due for renewal, but simulating renewal for dry run
Plugins selected: Authenticator nginx, Installer nginx
Renewing an existing certificate
Performing the following challenges:
http-01 challenge for erxes.acneskindisorder.com
Waiting for verification...
Cleaning up challenges

---

new certificate deployed with reload of nginx server; fullchain is
/etc/letsencrypt/live/erxes.acneskindisorder.com/fullchain.pem

---

---

** DRY RUN: simulating 'certbot renew' close to cert expiry
** (The test certificates below have not been saved.)

Congratulations, all renewals succeeded. The following certs have been renewed:
/etc/letsencrypt/live/erxes.acneskindisorder.com/fullchain.pem (success)
** DRY RUN: simulating 'certbot renew' close to cert expiry
** (The test certificates above have not been saved.)

---

IMPORTANT NOTES:

- Your account credentials have been saved in your Certbot
  configuration directory at /etc/letsencrypt. You should make a
  secure backup of this folder now. This configuration directory will
  also contain certificates and private keys obtained by Certbot so
  making regular backups of this folder is ideal.
```

Check your website in the broswer. You should see the **Secure Padlock** next to your URL. You are now ready to move onto the final steps to install **erxes** itself.

## Install erxes

All the dependencies for **erxes** are now installed. You have also configured your server. Follow these remaining steps to complete the installation of **erxes**.

### Download, extract and install each of the erxes components

- Create the folder directories for the installation of erxes.

```bash
$ cd ~
$ mkdir -p ~/erxes.io/erxes \
 -p ~/erxes.io/erxes-api\
 -p ~/erxes.io/erxes-crons \
 -p ~/erxes.io/erxes-workers \
 -p ~/erxes.io/erxes-widgets \
 -p ~/erxes.io/erxes-logger \
 -p ~/erxes.io/erxes-engages-email-sender \
 -p ~/erxes.io/erxes-email-verifier \
 -p ~/erxes.io/erxes-integrations \
 -p ~/erxes.io/erxes-elkSyncer
```

- Individually download and extract each of these 8 packages. (These commands place them in the proper installation directories.)

```bash
$ curl -L https://github.com/erxes/erxes/releases/download/0.15.2/erxes-0.15.2.tar.gz | tar -xz -C ~/erxes.io/erxes/
$ curl -L https://github.com/erxes/erxes/releases/download/0.15.2/erxes-widgets-0.15.2.tar.gz | tar -xz -C ~/erxes.io/erxes-widgets/
$ curl -L https://github.com/erxes/erxes-api/releases/download/0.15.2/erxes-api-0.15.2.tar.gz | tar -xz -C ~/erxes.io/erxes-api/
$ curl -L https://github.com/erxes/erxes-api/releases/download/0.15.2/erxes-email-verifier-0.15.2.tar.gz | tar -xz -C ~/erxes.io/erxes-email-verifier/
$ curl -L https://github.com/erxes/erxes-api/releases/download/0.15.2/erxes-engages-email-sender-0.15.2.tar.gz | tar -xz -C ~/erxes.io/erxes-engages-email-sender/
$ curl -L https://github.com/erxes/erxes-api/releases/download/0.15.2/erxes-logger-0.15.2.tar.gz | tar -xz -C ~/erxes.io/erxes-logger/
$ curl -L https://github.com/erxes/erxes-integrations/releases/download/0.15.2/erxes-integrations-0.15.2.tar.gz | tar -xz -C ~/erxes.io/erxes-integrations/
$ curl -L https://github.com/erxes/erxes-api/releases/download/0.15.2/erxes-elksyncer-0.15.2.tar.gz | tar -xz -C ~/erxes.io/erxes-elksyncer/
```

- Install package dependencies (using `yarn install`) required for the packages that make up **erxes**.

```bash
$ cd ~/erxes.io/erxes-widgets
$ yarn install

$ cd ~/erxes.io/erxes-api
$ yarn install

$ cd ~/erxes.io/erxes-email-verifier
$ yarn install

$ cd ~/erxes.io/erxes-engages-email-sender
$ yarn install

$ cd ~/erxes.io/erxes-logger
$ yarn install

$ cd ~/erxes.io/erxes-integrations
$ yarn install
```

- Install and configure this final package, following these commands.

```bash
$ cd ~/erxes.io/erxes-elksyncer/elkSyncer
$ sudo apt install python3-pip
$ pip3 install -r requirements.txt
$ sudo mkdir -p /var/log/mongo-connector/
$ sudo chown -R erxes:erxes /var/log/mongo-connector/
```

### Configure PM2 `ecosystem.config.js`

In the following steps, you will **copy** and **create** an `ecosystem.config.js` file that **PM2** uses to manage the processes behind **erxes**. **Before it will work, you need to provide your exact URL and a password to encrypt all the communication between your front-end and your server.**

- Create and open a new `ecosystem.config.js` file.

```bash
$ cd ~/erxes.io
$ sudo nano ecosystem.config.js
```

- Copy the following content into the file. This

```js
module.exports = {
  apps: [
    {
      name: 'erxes-api',
      script: 'dist',
      cwd: '/home/erxes/erxes.io/erxes-api',
      log_date_format: 'YYYY-MM-DD HH:mm Z',
      node_args: '--max_old_space_size=4096',
      env: {
        PORT: 3300,
        NODE_ENV: 'production',
        JWT_TOKEN_SECRET: 'YOUR_SECRET_TOKEN',
        DEBUG: 'erxes-api:*',
        MONGO_URL: 'mongodb://localhost/erxes',
        REDIS_HOST: 'localhost',
        REDIS_PORT: 6379,
        REDIS_PASSWORD: '',
        RABBITMQ_HOST: 'amqp://localhost',
        ELASTICSEARCH_URL: 'http://localhost:9200',
        MAIN_APP_DOMAIN: 'https://YOUR_DOMAIN_COM',
        WIDGETS_DOMAIN: '',
        INTEGRATIONS_API_DOMAIN: 'https://YOUR_DOMAIN_COM/integrations',
      },
    },
    {
      name: 'erxes-cronjobs',
      script: 'dist/cronJobs',
      cwd: '/home/erxes/erxes.io/erxes-api',
      log_date_format: 'YYYY-MM-DD HH:mm Z',
      node_args: '--max_old_space_size=4096',
      env: {
        PORT_CRONS: 3600,
        NODE_ENV: 'production',
        PROCESS_NAME: 'crons',
        DEBUG: 'erxes-crons:*',
        MONGO_URL: 'mongodb://localhost/erxes',
        REDIS_HOST: 'localhost',
        REDIS_PORT: 6379,
        REDIS_PASSWORD: '',
        RABBITMQ_HOST: 'amqp://localhost',
      },
    },
    {
      name: 'erxes-workers',
      script: 'dist/workers',
      cwd: '/home/erxes/erxes.io/erxes-api',
      log_date_format: 'YYYY-MM-DD HH:mm Z',
      node_args: '--max_old_space_size=4096',
      env: {
        PORT_WORKERS: 3700,
        NODE_ENV: 'production',
        DEBUG: 'erxes-workers:*',
        MONGO_URL: 'mongodb://localhost/erxes',
        REDIS_HOST: 'localhost',
        REDIS_PORT: 6379,
        REDIS_PASSWORD: '',
        RABBITMQ_HOST: 'amqp://localhost',
        JWT_TOKEN_SECRET: 'YOUR_SECRET_TOKEN',
      },
    },
    {
      name: 'erxes-widgets',
      script: 'dist',
      cwd: '/home/erxes/erxes.io/erxes-widgets',
      log_date_format: 'YYYY-MM-DD HH:mm Z',
      node_args: '--max_old_space_size=4096',
      env: {
        PORT: 3200,
        NODE_ENV: 'production',
        ROOT_URL: 'https://YOUR_DOMAIN_COM/widgets',
        API_URL: 'https://YOUR_DOMAIN_COM/api',
        API_SUBSCRIPTIONS_URL: 'wss://YOUR_DOMAIN_COM/api/subscriptions',
      },
    },
    {
      name: 'erxes-engages',
      script: 'dist',
      cwd: '/home/erxes/erxes.io/erxes-engages-email-sender',
      log_date_format: 'YYYY-MM-DD HH:mm Z',
      node_args: '--max_old_space_size=4096',
      env: {
        PORT: 3900,
        NODE_ENV: 'production',
        DEBUG: 'erxes-engages:*',
        MAIN_API_DOMAIN: 'https://YOUR_DOMAIN_COM/api',
        MONGO_URL: 'mongodb://localhost/erxes_engages',
        RABBITMQ_HOST: 'amqp://localhost',
        REDIS_HOST: 'localhost',
        REDIS_PORT: 6379,
        REDIS_PASSWORD: '',
      },
    },
    {
      name: 'erxes-logger',
      script: 'dist',
      cwd: '/home/erxes/erxes.io/erxes-logger',
      log_date_format: 'YYYY-MM-DD HH:mm Z',
      node_args: '--max_old_space_size=4096',
      env: {
        PORT: 3800,
        NODE_ENV: 'production',
        DEBUG: 'erxes-logs:*',
        MONGO_URL: 'mongodb://localhost/erxes_logger',
        RABBITMQ_HOST: 'amqp://localhost',
      },
    },
    {
      name: 'erxes-integrations',
      script: 'dist',
      cwd: '/home/erxes/erxes.io/erxes-integrations',
      log_date_format: 'YYYY-MM-DD HH:mm Z',
      node_args: '--max_old_space_size=4096',
      env: {
        PORT: 3400,
        NODE_ENV: 'production',
        DEBUG: 'erxes-integrations:*',
        DOMAIN: 'https://YOUR_DOMAIN_COM/integrations',
        MAIN_APP_DOMAIN: 'https://YOUR_DOMAIN_COM',
        MAIN_API_DOMAIN: 'https://YOUR_DOMAIN_COM/api',
        MONGO_URL: 'mongodb://localhost/erxes_integrations',
        RABBITMQ_HOST: 'amqp://localhost',
        REDIS_HOST: 'localhost',
        REDIS_PORT: 6379,
        REDIS_PASSWORD: '',
      },
    },
    {
      name: 'erxes-elkSyncer',
      script: 'main.py',
      cwd: '/home/erxes/erxes.io/erxes-elkSyncer/elkSyncer',
      log_date_format: 'YYYY-MM-DD HH:mm Z',
      interpreter: '/usr/bin/python3',
      env: {
        MONGO_URL: 'mongodb://localhost/erxes',
        ELASTICSEARCH_URL: 'http://localhost:9200',
      },
    },
    {
      name: 'erxes-email-verifier',
      script: 'dist',
      cwd: '/home/erxes/erxes.io/erxes-email-verifier',
      log_date_format: 'YYYY-MM-DD HH:mm Z',
      node_args: '--max_old_space_size=4096',
      env: {
        PORT_WORKERS: 3700,
        NODE_ENV: 'production',
        DEBUG: 'erxes-workers:*',
        MONGO_URL: 'mongodb://localhost/erxes',
        REDIS_HOST: 'localhost',
        REDIS_PORT: 6379,
        REDIS_PASSWORD: '',
        RABBITMQ_HOST: 'amqp://localhost',
        JWT_TOKEN_SECRET: 'YOUR_SECRET_TOKEN',
      },
    },
  ],
};
```

- Replace every instance of `YOUR_DOMAIN_COM` with your actual domain name.

For example,

```js
# change this
MAIN_APP_DOMAIN: 'https://YOUR_DOMAIN_COM',

# to this
MAIN_APP_DOMAIN: 'https://erxes.example.com',
```

:::caution Your Domain Name
You **MUST** replace all instances of **YOUR_DOMAIN_COM** with your **actual domain name** in the `ecosystem.config.js` file. If you do not, **erxes** will not work. See example above.
:::

- Replace every instance of `YOUR_SECRET_TOKEN` with a strong password. **The secret token is the same for each instance. You have only one secret token.** You can use this [Password Generator](https://passwordsgenerator.net/), to create a strong token.

```js
# change this
JWT_TOKEN_SECRET: 'YOUR_SECRET_TOKEN',

# to this, for example.
JWT_TOKEN_SECRET: '"D2E+N42:LPshXj$',
```

- Then save the file with `ctrl + x` and `y` to accept changes.

:::caution Secret Token
You **MUST** replace all instances of **YOUR_SECRET_TOKEN** with your own **unique and strong password** in the `ecosystem.config.js` file. If you do not, your expose your backend and you may run into security issues. See example above.
:::

- Start PM2

```bash
$ pm2 start ecosystem.config.js
```

- Generate a startup script. Copy/paste the script in the terminal and run it.

```bash
$ pm2 startup

# will generate a script like this

sudo env PATH=$PATH:/home/erxes/.nvm/versions/node/v12.16.3/bin /home/erxes/.nvm/versions/node/v12.16.3/lib/node_modules/pm2/bin/pm2 startup systemd -u erxes --hp /home/erxes

# now copy / paste it

$ sudo env PATH=$PATH:/home/erxes/.nvm/versions/node/v12.16.3/bin /home/erxes/.nvm/versions/node/v12.16.3/lib/node_modules/pm2/bin/pm2 startup systemd -u erxes --hp /home/erxes
```

- Save all the applications that **PM2** is managing.

```bash
$ pm2 save
```

- Verify all process are running.

```bash
$ pm2 l
```

The status of all the processes should say **online**.

### Configure frontend environment variables

In the previous step, you set environment variables using **PM2**, but **PM2** does not have access to the bundled front-end static code. Therefore, you need to set the environment variables needed from the front-end differently.

- Open the appropriate `env.js` file in the nano editor.

```bash
$ sudo nano ~/erxes.io/erxes/build/js/env.js
```

- Copy the following **environment variables** in between the **{ }**, and replace **YOUR_DOMAIN_COM** with your actual domain name.

```bash
    NODE_ENV: "production",
    REACT_APP_API_URL: "https://YOUR_DOMAIN_COM/api",
    REACT_APP_API_SUBSCRIPTION_URL: "wss://YOUR_DOMAIN_COM/api/subscriptions",
    REACT_APP_CDN_HOST: "https://YOUR_DOMAIN_COM/widgets"
```

It should look like this, but **with your actual domain name**:

```bash
window.env = {
    NODE_ENV: "production",
    REACT_APP_API_URL: "https://erxes.example.com/api",
    REACT_APP_API_SUBSCRIPTION_URL: "wss://erxes.example.com/api/subscriptions",
    REACT_APP_CDN_HOST: "https://erxes.example.com/widgets"
}
```

- save the file with `ctrl + x` and then `y` to accept all changes.

You are now ready to **initialize** and **load the permissions** in **erxes**.

</TabItem>
</Tabs>

- initialize Erxes

```bash
$ cd ~
$ export MONGO_URL="mongodb://localhost/erxes"
node ~/erxes.io/erxes-api/dist/commands/initProject.js

cd cd ~/erxes.io/erxes-api/dist
node commands/loadPermissi
```
