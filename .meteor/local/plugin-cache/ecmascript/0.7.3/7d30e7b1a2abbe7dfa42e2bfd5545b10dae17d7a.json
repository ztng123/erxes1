{"metadata":{"usedHelpers":["inherits","possibleConstructorReturn","classCallCheck","interopRequireDefault"],"marked":[],"modules":{"imports":[{"source":"react","imported":["default","PropTypes","Component"],"specifiers":[{"kind":"named","imported":"default","local":"React"},{"kind":"named","imported":"PropTypes","local":"PropTypes"},{"kind":"named","imported":"Component","local":"Component"}]},{"source":"meteor/erxes-notifier","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"Alert"}]},{"source":"/imports/react-ui/common","imported":["FilterableList"],"specifiers":[{"kind":"named","imported":"FilterableList","local":"FilterableList"}]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"/imports/react-ui/inbox/components/assignBox/AssignBox.js","filenameRelative":"/imports/react-ui/inbox/components/assignBox/AssignBox.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/imports/react-ui/inbox/components/assignBox/AssignBox.js.map","sourceFileName":"/imports/react-ui/inbox/components/assignBox/AssignBox.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"AssignBox"},"ignored":false,"code":"var _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _possibleConstructorReturn2 = require(\"babel-runtime/helpers/possibleConstructorReturn\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require(\"babel-runtime/helpers/inherits\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nvar React = void 0,\n    PropTypes = void 0,\n    Component = void 0;\nmodule.importSync(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  },\n  PropTypes: function (v) {\n    PropTypes = v;\n  },\n  Component: function (v) {\n    Component = v;\n  }\n}, 0);\nvar Alert = void 0;\nmodule.importSync(\"meteor/erxes-notifier\", {\n  \"default\": function (v) {\n    Alert = v;\n  }\n}, 1);\nvar FilterableList = void 0;\nmodule.importSync(\"/imports/react-ui/common\", {\n  FilterableList: function (v) {\n    FilterableList = v;\n  }\n}, 2);\nvar propTypes = {\n  targets: PropTypes.array.isRequired,\n  assignees: PropTypes.array.isRequired,\n  assign: PropTypes.func.isRequired,\n  clear: PropTypes.func.isRequired,\n  event: PropTypes.oneOf(['onClick', 'onExit']),\n  className: PropTypes.string\n};\n\nvar AssignBox = function (_Component) {\n  (0, _inherits3.default)(AssignBox, _Component);\n\n  function AssignBox(props) {\n    (0, _classCallCheck3.default)(this, AssignBox);\n\n    var _this = (0, _possibleConstructorReturn3.default)(this, _Component.call(this, props));\n\n    _this.state = {\n      assingeesForList: _this.generateAssignParams(props.assignees, props.targets)\n    };\n    _this.removeAssignee = _this.removeAssignee.bind(_this);\n    _this.assign = _this.assign.bind(_this);\n    return _this;\n  }\n\n  AssignBox.prototype.componentWillReceiveProps = function () {\n    function componentWillReceiveProps(nextProps) {\n      this.setState({\n        assingeesForList: this.generateAssignParams(nextProps.assignees, nextProps.targets)\n      });\n    }\n\n    return componentWillReceiveProps;\n  }();\n\n  AssignBox.prototype.assign = function () {\n    function assign(items, id) {\n      var _props = this.props,\n          assign = _props.assign,\n          targets = _props.targets;\n      assign({\n        targetIds: targets.map(function (t) {\n          return t._id;\n        }),\n        assignedUserId: id\n      }, function (error) {\n        if (error) {\n          Alert.error(error.reason);\n        }\n\n        return Alert.success('The conversation Assignee has been renewed.');\n      });\n    }\n\n    return assign;\n  }();\n\n  AssignBox.prototype.generateAssignParams = function () {\n    function generateAssignParams(assignees, targets) {\n      return assignees.map(function (assignee) {\n        // Current tag's selection state (all, some or none)\n        var count = targets.reduce(function (memo, target) {\n          return memo + (target.assignedUserId && target.assignedUserId.indexOf(assignee._id) > -1);\n        }, 0);\n        var state = 'none';\n\n        if (count === targets.length) {\n          state = 'all';\n        } else if (count < targets.length && count > 0) {\n          state = 'some';\n        }\n\n        return {\n          _id: assignee._id,\n          title: assignee.details.fullName || assignee.emails[0].address,\n          selectedBy: state\n        };\n      });\n    }\n\n    return generateAssignParams;\n  }();\n\n  AssignBox.prototype.removeAssignee = function () {\n    function removeAssignee() {\n      var _props2 = this.props,\n          clear = _props2.clear,\n          targets = _props2.targets;\n      clear(targets.map(function (t) {\n        return t._id;\n      }), function (error) {\n        if (error) {\n          Alert.error('Error', error.reason);\n        }\n      });\n    }\n\n    return removeAssignee;\n  }();\n\n  AssignBox.prototype.render = function () {\n    function render() {\n      var _props4;\n\n      var _props3 = this.props,\n          event = _props3.event,\n          className = _props3.className;\n      var links = [{\n        title: 'Remove assignee',\n        href: '#',\n        onClick: this.removeAssignee\n      }];\n      var props = (_props4 = {\n        className: className,\n        links: links,\n        items: this.state.assingeesForList\n      }, _props4[event] = this.assign, _props4);\n      return React.createElement(FilterableList, props);\n    }\n\n    return render;\n  }();\n\n  return AssignBox;\n}(Component);\n\nAssignBox.propTypes = propTypes;\nmodule.export(\"default\", exports.default = AssignBox);","map":{"version":3,"sources":["/imports/react-ui/inbox/components/assignBox/AssignBox.js"],"names":["React","PropTypes","Component","module","importSync","v","Alert","FilterableList","propTypes","targets","array","isRequired","assignees","assign","func","clear","event","oneOf","className","string","AssignBox","props","state","assingeesForList","generateAssignParams","removeAssignee","bind","componentWillReceiveProps","nextProps","setState","items","id","targetIds","map","t","_id","assignedUserId","error","reason","success","count","reduce","memo","target","indexOf","assignee","length","title","details","fullName","emails","address","selectedBy","render","links","href","onClick","export","exports","default"],"mappings":";;;;;;;;;;;;;;AAAA,IAAIA,cAAJ;AAAA,IAAUC,kBAAV;AAAA,IAAoBC,kBAApB;AAA8BC,OAAOC,UAAP,CAAkB,OAAlB,EAA0B;AAAC,aAAQ,UAASC,CAAT,EAAW;AAACL,YAAMK,CAAN;AAAQ,GAA7B;AAA8BJ,aAAU,UAASI,CAAT,EAAW;AAACJ,gBAAUI,CAAV;AAAY,GAAhE;AAAiEH,aAAU,UAASG,CAAT,EAAW;AAACH,gBAAUG,CAAV;AAAY;AAAnG,CAA1B,EAA+H,CAA/H;AAAkI,IAAIC,cAAJ;AAAUH,OAAOC,UAAP,CAAkB,uBAAlB,EAA0C;AAAC,aAAQ,UAASC,CAAT,EAAW;AAACC,YAAMD,CAAN;AAAQ;AAA7B,CAA1C,EAAyE,CAAzE;AAA4E,IAAIE,uBAAJ;AAAmBJ,OAAOC,UAAP,CAAkB,0BAAlB,EAA6C;AAACG,kBAAe,UAASF,CAAT,EAAW;AAACE,qBAAeF,CAAf;AAAiB;AAA7C,CAA7C,EAA4F,CAA5F;AAMzQ,IAAMG,YAAY;AAChBC,WAASR,UAAUS,KAAV,CAAgBC,UADT;AAEhBC,aAAWX,UAAUS,KAAV,CAAgBC,UAFX;AAGhBE,UAAQZ,UAAUa,IAAV,CAAeH,UAHP;AAIhBI,SAAOd,UAAUa,IAAV,CAAeH,UAJN;AAKhBK,SAAOf,UAAUgB,KAAV,CAAgB,CAAC,SAAD,EAAY,QAAZ,CAAhB,CALS;AAMhBC,aAAWjB,UAAUkB;AANL,CAAlB;;IASMC,S;;;AACJ,qBAAYC,KAAZ,EAAmB;AAAA;;AAAA,+DACjB,sBAAMA,KAAN,CADiB;;AAGjB,UAAKC,KAAL,GAAa;AACXC,wBAAkB,MAAKC,oBAAL,CAA0BH,MAAMT,SAAhC,EAA2CS,MAAMZ,OAAjD;AADP,KAAb;AAIA,UAAKgB,cAAL,GAAsB,MAAKA,cAAL,CAAoBC,IAApB,OAAtB;AACA,UAAKb,MAAL,GAAc,MAAKA,MAAL,CAAYa,IAAZ,OAAd;AARiB;AASlB;;sBAEDC,yB;uCAA0BC,S,EAAW;AACnC,WAAKC,QAAL,CAAc;AACZN,0BAAkB,KAAKC,oBAAL,CAA0BI,UAAUhB,SAApC,EAA+CgB,UAAUnB,OAAzD;AADN,OAAd;AAGD;;;;;sBAEDI,M;oBAAOiB,K,EAAOC,E,EAAI;AAAA,mBACY,KAAKV,KADjB;AAAA,UACRR,MADQ,UACRA,MADQ;AAAA,UACAJ,OADA,UACAA,OADA;AAGhBI,aACE;AACEmB,mBAAWvB,QAAQwB,GAAR,CAAY;AAAA,iBAAKC,EAAEC,GAAP;AAAA,SAAZ,CADb;AAEEC,wBAAgBL;AAFlB,OADF,EAKE,iBAAS;AACP,YAAIM,KAAJ,EAAW;AACT/B,gBAAM+B,KAAN,CAAYA,MAAMC,MAAlB;AACD;;AACD,eAAOhC,MAAMiC,OAAN,CAAc,6CAAd,CAAP;AACD,OAVH;AAYD;;;;;sBAEDf,oB;kCAAqBZ,S,EAAWH,O,EAAS;AACvC,aAAOG,UAAUqB,GAAV,CAAc,oBAAY;AAC/B;AACA,YAAMO,QAAQ/B,QAAQgC,MAAR,CACZ,UAACC,IAAD,EAAOC,MAAP;AAAA,iBACED,QAAQC,OAAOP,cAAP,IAAyBO,OAAOP,cAAP,CAAsBQ,OAAtB,CAA8BC,SAASV,GAAvC,IAA8C,CAAC,CAAhF,CADF;AAAA,SADY,EAGZ,CAHY,CAAd;AAMA,YAAIb,QAAQ,MAAZ;;AAEA,YAAIkB,UAAU/B,QAAQqC,MAAtB,EAA8B;AAC5BxB,kBAAQ,KAAR;AACD,SAFD,MAEO,IAAIkB,QAAQ/B,QAAQqC,MAAhB,IAA0BN,QAAQ,CAAtC,EAAyC;AAC9ClB,kBAAQ,MAAR;AACD;;AAED,eAAO;AACLa,eAAKU,SAASV,GADT;AAELY,iBAAOF,SAASG,OAAT,CAAiBC,QAAjB,IAA6BJ,SAASK,MAAT,CAAgB,CAAhB,EAAmBC,OAFlD;AAGLC,sBAAY9B;AAHP,SAAP;AAKD,OArBM,CAAP;AAsBD;;;;;sBAEDG,c;8BAAiB;AAAA,oBACY,KAAKJ,KADjB;AAAA,UACPN,KADO,WACPA,KADO;AAAA,UACAN,OADA,WACAA,OADA;AAEfM,YAAMN,QAAQwB,GAAR,CAAY;AAAA,eAAKC,EAAEC,GAAP;AAAA,OAAZ,CAAN,EAA+B,iBAAS;AACtC,YAAIE,KAAJ,EAAW;AACT/B,gBAAM+B,KAAN,CAAY,OAAZ,EAAqBA,MAAMC,MAA3B;AACD;AACF,OAJD;AAKD;;;;;sBAEDe,M;sBAAS;AAAA;;AAAA,oBACsB,KAAKhC,KAD3B;AAAA,UACCL,KADD,WACCA,KADD;AAAA,UACQE,SADR,WACQA,SADR;AAGP,UAAMoC,QAAQ,CACZ;AACEP,eAAO,iBADT;AAEEQ,cAAM,GAFR;AAGEC,iBAAS,KAAK/B;AAHhB,OADY,CAAd;AAQA,UAAMJ;AACJH,4BADI;AAEJoC,oBAFI;AAGJxB,eAAO,KAAKR,KAAL,CAAWC;AAHd,iBAIHP,KAJG,IAIK,KAAKH,MAJV,UAAN;AAOA,aAAO,oBAAC,cAAD,EAAoBQ,KAApB,CAAP;AACD;;;;;;EAxFqBnB,S;;AA2FxBkB,UAAUZ,SAAV,GAAsBA,SAAtB;AA1GAL,OAAOsD,MAAP,CAAc,SAAd,EAAwBC,QAAQC,OAAR,GA4GTvC,SA5Gf","file":"/imports/react-ui/inbox/components/assignBox/AssignBox.js.map","sourcesContent":["/* eslint-disable react/jsx-no-bind */\n\nimport React, { PropTypes, Component } from 'react';\nimport Alert from 'meteor/erxes-notifier';\nimport { FilterableList } from '/imports/react-ui/common';\n\nconst propTypes = {\n  targets: PropTypes.array.isRequired,\n  assignees: PropTypes.array.isRequired,\n  assign: PropTypes.func.isRequired,\n  clear: PropTypes.func.isRequired,\n  event: PropTypes.oneOf(['onClick', 'onExit']),\n  className: PropTypes.string,\n};\n\nclass AssignBox extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      assingeesForList: this.generateAssignParams(props.assignees, props.targets),\n    };\n\n    this.removeAssignee = this.removeAssignee.bind(this);\n    this.assign = this.assign.bind(this);\n  }\n\n  componentWillReceiveProps(nextProps) {\n    this.setState({\n      assingeesForList: this.generateAssignParams(nextProps.assignees, nextProps.targets),\n    });\n  }\n\n  assign(items, id) {\n    const { assign, targets } = this.props;\n\n    assign(\n      {\n        targetIds: targets.map(t => t._id),\n        assignedUserId: id,\n      },\n      error => {\n        if (error) {\n          Alert.error(error.reason);\n        }\n        return Alert.success('The conversation Assignee has been renewed.');\n      },\n    );\n  }\n\n  generateAssignParams(assignees, targets) {\n    return assignees.map(assignee => {\n      // Current tag's selection state (all, some or none)\n      const count = targets.reduce(\n        (memo, target) =>\n          memo + (target.assignedUserId && target.assignedUserId.indexOf(assignee._id) > -1),\n        0,\n      );\n\n      let state = 'none';\n\n      if (count === targets.length) {\n        state = 'all';\n      } else if (count < targets.length && count > 0) {\n        state = 'some';\n      }\n\n      return {\n        _id: assignee._id,\n        title: assignee.details.fullName || assignee.emails[0].address,\n        selectedBy: state,\n      };\n    });\n  }\n\n  removeAssignee() {\n    const { clear, targets } = this.props;\n    clear(targets.map(t => t._id), error => {\n      if (error) {\n        Alert.error('Error', error.reason);\n      }\n    });\n  }\n\n  render() {\n    const { event, className } = this.props;\n\n    const links = [\n      {\n        title: 'Remove assignee',\n        href: '#',\n        onClick: this.removeAssignee,\n      },\n    ];\n\n    const props = {\n      className,\n      links,\n      items: this.state.assingeesForList,\n      [event]: this.assign,\n    };\n\n    return <FilterableList {...props} />;\n  }\n}\n\nAssignBox.propTypes = propTypes;\n\nexport default AssignBox;\n"]},"hash":"7d30e7b1a2abbe7dfa42e2bfd5545b10dae17d7a"}
