{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[{"source":"meteor/underscore","imported":["_"],"specifiers":[{"kind":"named","imported":"_","local":"_"}]},{"source":"react","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"React"}]},{"source":"prop-types","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"PropTypes"}]},{"source":"moment","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"moment"}]},{"source":"classnames","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"classNames"}]},{"source":"react-bootstrap","imported":["Table"],"specifiers":[{"kind":"named","imported":"Table","local":"Table"}]},{"source":"/imports/react-ui/common","imported":["NameCard","Attachment","Tip"],"specifiers":[{"kind":"named","imported":"NameCard","local":"NameCard"},{"kind":"named","imported":"Attachment","local":"Attachment"},{"kind":"named","imported":"Tip","local":"Tip"}]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"/imports/react-ui/inbox/components/conversation/Message.js","filenameRelative":"/imports/react-ui/inbox/components/conversation/Message.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/imports/react-ui/inbox/components/conversation/Message.js.map","sourceFileName":"/imports/react-ui/inbox/components/conversation/Message.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"Message"},"ignored":false,"code":"var _ = void 0;\n\nmodule.importSync(\"meteor/underscore\", {\n  _: function (v) {\n    _ = v;\n  }\n}, 0);\nvar React = void 0;\nmodule.importSync(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  }\n}, 1);\nvar PropTypes = void 0;\nmodule.importSync(\"prop-types\", {\n  \"default\": function (v) {\n    PropTypes = v;\n  }\n}, 2);\nvar moment = void 0;\nmodule.importSync(\"moment\", {\n  \"default\": function (v) {\n    moment = v;\n  }\n}, 3);\nvar classNames = void 0;\nmodule.importSync(\"classnames\", {\n  \"default\": function (v) {\n    classNames = v;\n  }\n}, 4);\nvar Table = void 0;\nmodule.importSync(\"react-bootstrap\", {\n  Table: function (v) {\n    Table = v;\n  }\n}, 5);\nvar NameCard = void 0,\n    Attachment = void 0,\n    Tip = void 0;\nmodule.importSync(\"/imports/react-ui/common\", {\n  NameCard: function (v) {\n    NameCard = v;\n  },\n  Attachment: function (v) {\n    Attachment = v;\n  },\n  Tip: function (v) {\n    Tip = v;\n  }\n}, 6);\nvar propTypes = {\n  message: PropTypes.object.isRequired,\n  staff: PropTypes.bool,\n  isSameUser: PropTypes.bool\n};\n\nfunction Message(_ref) {\n  var message = _ref.message,\n      staff = _ref.staff,\n      isSameUser = _ref.isSameUser;\n  var user = message.user || {};\n  var customer = message.customer || {};\n  var faceboodData = message.facebookData;\n  var isReaction = faceboodData && faceboodData.item === 'reaction';\n  var isPhotoPost = faceboodData && faceboodData.item === 'photo';\n  var isVideoPost = faceboodData && faceboodData.item === 'video' && faceboodData.videoId;\n  var hasAttachment = message.attachments && message.attachments.length > 0;\n  var classes = classNames({\n    'conversation-message-container': true,\n    staff: staff,\n    internal: message.internal,\n    attachment: hasAttachment || isPhotoPost || isVideoPost,\n    fbpost: isPhotoPost || isVideoPost\n  });\n  var prop = staff ? {\n    user: user\n  } : {\n    customer: customer\n  };\n\n  var renderAvatar = function () {\n    if (!isSameUser) {\n      return React.createElement(NameCard.Avatar, prop);\n    }\n\n    return null;\n  };\n\n  var renderName = function () {\n    var fullName = 'Unknown';\n    var user = prop.user,\n        customer = prop.customer;\n\n    if (user) {\n      fullName = user.details && user.deteails.fullName;\n    } else if (customer) {\n      fullName = customer.name;\n    }\n\n    return fullName;\n  };\n\n  var renderIframe = function (src) {\n    var iframeSrc = src;\n    return React.createElement(\"iframe\", {\n      src: iframeSrc,\n      width: \"480\",\n      height: \"280\",\n      scrolling: \"no\",\n      frameBorder: \"0\",\n      allowTransparency: \"true\"\n    });\n  };\n\n  var renderVideoIframe = function () {\n    if (isVideoPost) {\n      var iframeSrc = \"https://www.facebook.com/video/embed\\n        ?video_id=\" + faceboodData.videoId + \"&width=500\";\n      return renderIframe(iframeSrc);\n    }\n\n    return null;\n  };\n\n  var renderAttachment = function () {\n    if (hasAttachment) {\n      return React.createElement(Attachment, {\n        attachment: message.attachments[0]\n      });\n    }\n\n    if (isPhotoPost) {\n      return renderIframe(\"https://www.facebook.com/plugins/post.php?\\n        href=https://www.facebook.com/photo.php?fbid=\" + faceboodData.photoId);\n    }\n\n    return null;\n  };\n\n  var renderMessage = function () {\n    if (isReaction) {\n      var reactingClass = \"reaction-\" + faceboodData.reactionType;\n      return React.createElement(\n        Tip,\n        {\n          text: renderName()\n        },\n        React.createElement(\n          \"div\",\n          {\n            className: \"reaction\"\n          },\n          React.createElement(\"span\", {\n            className: reactingClass\n          })\n        )\n      );\n    }\n\n    if (message.formWidgetData) {\n      return React.createElement(\n        \"div\",\n        {\n          className: \"form-data\"\n        },\n        React.createElement(\n          Table,\n          {\n            striped: true\n          },\n          React.createElement(\n            \"thead\",\n            null,\n            React.createElement(\n              \"tr\",\n              null,\n              React.createElement(\n                \"th\",\n                {\n                  className: \"text-center\",\n                  colSpan: \"2\"\n                },\n                message.content\n              )\n            )\n          ),\n          React.createElement(\n            \"tbody\",\n            null,\n            _.map(message.formWidgetData, function (data, index) {\n              return React.createElement(\n                \"tr\",\n                {\n                  key: index\n                },\n                React.createElement(\n                  \"td\",\n                  {\n                    width: \"40%\"\n                  },\n                  React.createElement(\n                    \"b\",\n                    null,\n                    data.text,\n                    \":\"\n                  )\n                ),\n                data.validation === 'date' ? React.createElement(\n                  \"td\",\n                  {\n                    width: \"60%\"\n                  },\n                  moment(data.value).format('YYYY/MM/DD')\n                ) : React.createElement(\n                  \"td\",\n                  {\n                    width: \"60%\"\n                  },\n                  data.value\n                )\n              );\n            })\n          )\n        )\n      );\n    }\n\n    return React.createElement(\n      \"div\",\n      {\n        className: classes\n      },\n      renderAvatar(),\n      React.createElement(\n        \"div\",\n        {\n          className: \"body\"\n        },\n        React.createElement(\"span\", {\n          dangerouslySetInnerHTML: {\n            __html: message.content\n          }\n        }),\n        renderVideoIframe(),\n        renderAttachment()\n      ),\n      React.createElement(\n        \"footer\",\n        null,\n        moment(message.createdAt).format('YYYY-MM-DD, HH:mm:ss')\n      )\n    );\n  };\n\n  return renderMessage();\n}\n\nMessage.propTypes = propTypes;\nmodule.export(\"default\", exports.default = Message);","map":{"version":3,"sources":["/imports/react-ui/inbox/components/conversation/Message.js"],"names":["_","module","importSync","v","React","PropTypes","moment","classNames","Table","NameCard","Attachment","Tip","propTypes","message","object","isRequired","staff","bool","isSameUser","Message","user","customer","faceboodData","facebookData","isReaction","item","isPhotoPost","isVideoPost","videoId","hasAttachment","attachments","length","classes","internal","attachment","fbpost","prop","renderAvatar","renderName","fullName","details","deteails","name","renderIframe","iframeSrc","src","renderVideoIframe","renderAttachment","photoId","renderMessage","reactingClass","reactionType","formWidgetData","content","map","data","index","text","validation","value","format","__html","createdAt","export","exports","default"],"mappings":"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","file":"/imports/react-ui/inbox/components/conversation/Message.js.map","sourcesContent":["/* eslint-disable react/no-danger */\n\nimport { _ } from 'meteor/underscore';\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport moment from 'moment';\nimport classNames from 'classnames';\nimport { Table } from 'react-bootstrap';\nimport { NameCard, Attachment, Tip } from '/imports/react-ui/common';\n\nconst propTypes = {\n  message: PropTypes.object.isRequired,\n  staff: PropTypes.bool,\n  isSameUser: PropTypes.bool,\n};\n\nfunction Message({ message, staff, isSameUser }) {\n  const user = message.user || {};\n  const customer = message.customer || {};\n  const faceboodData = message.facebookData;\n  const isReaction = faceboodData && faceboodData.item === 'reaction';\n  const isPhotoPost = faceboodData && faceboodData.item === 'photo';\n  const isVideoPost = faceboodData && faceboodData.item === 'video' && faceboodData.videoId;\n  const hasAttachment = message.attachments && message.attachments.length > 0;\n\n  const classes = classNames({\n    'conversation-message-container': true,\n    staff,\n    internal: message.internal,\n    attachment: hasAttachment || isPhotoPost || isVideoPost,\n    fbpost: isPhotoPost || isVideoPost,\n  });\n\n  const prop = staff ? { user } : { customer };\n\n  const renderAvatar = () => {\n    if (!isSameUser) {\n      return <NameCard.Avatar {...prop} />;\n    }\n\n    return null;\n  };\n\n  const renderName = () => {\n    let fullName = 'Unknown';\n\n    const { user, customer } = prop;\n\n    if (user) {\n      fullName = user.details && user.deteails.fullName;\n    } else if (customer) {\n      fullName = customer.name;\n    }\n\n    return fullName;\n  };\n\n  const renderIframe = src => {\n    const iframeSrc = src;\n    return (\n      <iframe\n        src={iframeSrc}\n        width=\"480\"\n        height=\"280\"\n        scrolling=\"no\"\n        frameBorder=\"0\"\n        allowTransparency=\"true\"\n      />\n    );\n  };\n\n  const renderVideoIframe = () => {\n    if (isVideoPost) {\n      const iframeSrc = `https://www.facebook.com/video/embed\n        ?video_id=${faceboodData.videoId}&width=500`;\n\n      return renderIframe(iframeSrc);\n    }\n\n    return null;\n  };\n\n  const renderAttachment = () => {\n    if (hasAttachment) {\n      return <Attachment attachment={message.attachments[0]} />;\n    }\n\n    if (isPhotoPost) {\n      return renderIframe(\n        `https://www.facebook.com/plugins/post.php?\n        href=https://www.facebook.com/photo.php?fbid=${faceboodData.photoId}`,\n      );\n    }\n\n    return null;\n  };\n\n  const renderMessage = () => {\n    if (isReaction) {\n      const reactingClass = `reaction-${faceboodData.reactionType}`;\n\n      return (\n        <Tip text={renderName()}>\n          <div className=\"reaction\">\n            <span className={reactingClass} />\n          </div>\n        </Tip>\n      );\n    }\n    if (message.formWidgetData) {\n      return (\n        <div className=\"form-data\">\n          <Table striped>\n            <thead>\n              <tr>\n                <th className=\"text-center\" colSpan=\"2\">\n                  {message.content}\n                </th>\n              </tr>\n            </thead>\n            <tbody>\n              {_.map(message.formWidgetData, (data, index) => (\n                <tr key={index}>\n                  <td width=\"40%\">\n                    <b>\n                      {data.text}:\n                    </b>\n                  </td>\n                  {data.validation === 'date'\n                    ? <td width=\"60%\">\n                        {moment(data.value).format('YYYY/MM/DD')}\n                      </td>\n                    : <td width=\"60%\">\n                        {data.value}\n                      </td>}\n                </tr>\n              ))}\n            </tbody>\n          </Table>\n        </div>\n      );\n    }\n\n    return (\n      <div className={classes}>\n        {renderAvatar()}\n        <div className=\"body\">\n          <span dangerouslySetInnerHTML={{ __html: message.content }} />\n\n          {renderVideoIframe()}\n          {renderAttachment()}\n        </div>\n        <footer>\n          {moment(message.createdAt).format('YYYY-MM-DD, HH:mm:ss')}\n        </footer>\n      </div>\n    );\n  };\n\n  return renderMessage();\n}\n\nMessage.propTypes = propTypes;\n\nexport default Message;\n"]},"hash":"df806bafa9e6a9400a3a04b0568b9d4e8c933c25"}
