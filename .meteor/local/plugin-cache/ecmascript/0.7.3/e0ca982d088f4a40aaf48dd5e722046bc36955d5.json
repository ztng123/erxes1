{"metadata":{"usedHelpers":["inherits","possibleConstructorReturn","classCallCheck","interopRequireDefault"],"marked":[],"modules":{"imports":[{"source":"react","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"React"}]},{"source":"prop-types","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"PropTypes"}]},{"source":"react-bootstrap","imported":["FormControl","Button","ControlLabel","FormGroup"],"specifiers":[{"kind":"named","imported":"FormControl","local":"FormControl"},{"kind":"named","imported":"Button","local":"Button"},{"kind":"named","imported":"ControlLabel","local":"ControlLabel"},{"kind":"named","imported":"FormGroup","local":"FormGroup"}]},{"source":"/imports/api/engage/constants","imported":["METHODS","MESSAGE_KINDS"],"specifiers":[{"kind":"named","imported":"METHODS","local":"METHODS"},{"kind":"named","imported":"MESSAGE_KINDS","local":"MESSAGE_KINDS"}]},{"source":"/imports/react-ui/layout/components","imported":["Wrapper"],"specifiers":[{"kind":"named","imported":"Wrapper","local":"Wrapper"}]},{"source":"/imports/api/engage/constants","imported":["VISITOR_AUDIENCE_RULES","RULE_CONDITIONS"],"specifiers":[{"kind":"named","imported":"VISITOR_AUDIENCE_RULES","local":"VISITOR_AUDIENCE_RULES"},{"kind":"named","imported":"RULE_CONDITIONS","local":"RULE_CONDITIONS"}]},{"source":"./FormBase","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"FormBase"}]},{"source":"./MessengerForm","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"MessengerForm"}]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"/imports/react-ui/engage/components/VisitorForm.js","filenameRelative":"/imports/react-ui/engage/components/VisitorForm.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/imports/react-ui/engage/components/VisitorForm.js.map","sourceFileName":"/imports/react-ui/engage/components/VisitorForm.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"VisitorForm"},"ignored":false,"code":"var _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _possibleConstructorReturn2 = require(\"babel-runtime/helpers/possibleConstructorReturn\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require(\"babel-runtime/helpers/inherits\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nvar React = void 0;\nmodule.importSync(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  }\n}, 0);\nvar PropTypes = void 0;\nmodule.importSync(\"prop-types\", {\n  \"default\": function (v) {\n    PropTypes = v;\n  }\n}, 1);\nvar FormControl = void 0,\n    Button = void 0,\n    ControlLabel = void 0,\n    FormGroup = void 0;\nmodule.importSync(\"react-bootstrap\", {\n  FormControl: function (v) {\n    FormControl = v;\n  },\n  Button: function (v) {\n    Button = v;\n  },\n  ControlLabel: function (v) {\n    ControlLabel = v;\n  },\n  FormGroup: function (v) {\n    FormGroup = v;\n  }\n}, 2);\nvar METHODS = void 0,\n    MESSAGE_KINDS = void 0;\nmodule.importSync(\"/imports/api/engage/constants\", {\n  METHODS: function (v) {\n    METHODS = v;\n  },\n  MESSAGE_KINDS: function (v) {\n    MESSAGE_KINDS = v;\n  }\n}, 3);\nvar Wrapper = void 0;\nmodule.importSync(\"/imports/react-ui/layout/components\", {\n  Wrapper: function (v) {\n    Wrapper = v;\n  }\n}, 4);\nvar VISITOR_AUDIENCE_RULES = void 0,\n    RULE_CONDITIONS = void 0;\nmodule.importSync(\"/imports/api/engage/constants\", {\n  VISITOR_AUDIENCE_RULES: function (v) {\n    VISITOR_AUDIENCE_RULES = v;\n  },\n  RULE_CONDITIONS: function (v) {\n    RULE_CONDITIONS = v;\n  }\n}, 5);\nvar FormBase = void 0;\nmodule.importSync(\"./FormBase\", {\n  \"default\": function (v) {\n    FormBase = v;\n  }\n}, 6);\nvar MessengerForm = void 0;\nmodule.importSync(\"./MessengerForm\", {\n  \"default\": function (v) {\n    MessengerForm = v;\n  }\n}, 7);\nvar propTypes = {\n  brands: PropTypes.array\n};\n\nvar VisitorForm = function (_FormBase) {\n  (0, _inherits3.default)(VisitorForm, _FormBase);\n\n  function VisitorForm(props) {\n    (0, _classCallCheck3.default)(this, VisitorForm);\n\n    var _this = (0, _possibleConstructorReturn3.default)(this, _FormBase.call(this, props));\n\n    var message = props.message || {};\n    var messenger = message.messenger ? message.messenger : {};\n    var rules = messenger.rules ? messenger.rules : [];\n    _this.state = {\n      messengerContent: '',\n      rules: rules\n    }; // binds\n\n    _this.onMessengerContentChange = _this.onMessengerContentChange.bind(_this);\n    _this.addRule = _this.addRule.bind(_this);\n    return _this;\n  }\n\n  VisitorForm.prototype.generateDoc = function () {\n    function generateDoc(e) {\n      e.preventDefault();\n      var doc = {\n        kind: MESSAGE_KINDS.VISITOR_AUTO,\n        title: document.getElementById('title').value,\n        fromUserId: document.getElementById('fromUserId').value,\n        method: METHODS.MESSENGER,\n        messenger: {\n          rules: this.state.rules,\n          brandId: document.getElementById('brandId').value,\n          sentAs: document.getElementById('messengerSentAs').value,\n          content: this.state.messengerContent\n        }\n      };\n      return doc;\n    }\n\n    return generateDoc;\n  }();\n\n  VisitorForm.prototype.onMessengerContentChange = function () {\n    function onMessengerContentChange(content) {\n      this.setState({\n        messengerContent: content\n      });\n    }\n\n    return onMessengerContentChange;\n  }();\n\n  VisitorForm.prototype.addRule = function () {\n    function addRule(e) {\n      var rules = this.state.rules;\n      var selectedOption = e.target.options[e.target.selectedIndex];\n\n      if (selectedOption.value) {\n        rules.push({\n          _id: Math.random().toString(),\n          kind: selectedOption.value,\n          text: selectedOption.text,\n          condition: '',\n          value: ''\n        });\n        this.setState({\n          rules: rules\n        });\n      }\n    }\n\n    return addRule;\n  }();\n\n  VisitorForm.prototype.renderRule = function () {\n    function renderRule(rule) {\n      var _this2 = this;\n\n      var remove = function () {\n        var rules = _this2.state.rules;\n        rules = rules.filter(function (r) {\n          return r._id !== rule._id;\n        });\n\n        _this2.setState({\n          rules: rules\n        });\n      };\n\n      var changeProp = function (name, value) {\n        var rules = _this2.state.rules; // find current editing one\n\n        var currentRule = rules.find(function (r) {\n          return r._id === rule._id;\n        }); // set new value\n\n        currentRule[name] = value;\n\n        _this2.setState({\n          rules: rules\n        });\n      };\n\n      var onChangeValue = function (e) {\n        changeProp('value', e.target.value);\n      };\n\n      var onChangeCondition = function (e) {\n        changeProp('condition', e.target.value);\n      };\n\n      return React.createElement(\n        FormGroup,\n        {\n          key: rule._id\n        },\n        React.createElement(\n          ControlLabel,\n          null,\n          rule.text,\n          \":\"\n        ),\n        React.createElement(\n          \"div\",\n          {\n            className: \"flex-form\"\n          },\n          React.createElement(\n            FormControl,\n            {\n              className: \"flex-item\",\n              componentClass: \"select\",\n              defaultValue: rule.condition,\n              onChange: onChangeCondition\n            },\n            RULE_CONDITIONS[rule.kind].map(function (cond, index) {\n              return React.createElement(\n                \"option\",\n                {\n                  key: index,\n                  value: cond.value\n                },\n                cond.text\n              );\n            })\n          ),\n          React.createElement(FormControl, {\n            className: \"flex-item\",\n            type: \"text\",\n            value: rule.value,\n            onChange: onChangeValue\n          }),\n          React.createElement(\n            Button,\n            {\n              className: \"flex-item\",\n              bsSize: \"small\",\n              onClick: remove,\n              bsStyle: \"danger\"\n            },\n            React.createElement(\"i\", {\n              className: \"ion-close-round\"\n            })\n          )\n        )\n      );\n    }\n\n    return renderRule;\n  }();\n\n  VisitorForm.prototype.renderSidebarExtra = function () {\n    function renderSidebarExtra() {\n      var _this3 = this;\n\n      var Section = Wrapper.Sidebar.Section;\n      var Title = Wrapper.Sidebar.Section.Title;\n      return React.createElement(\n        Section,\n        null,\n        React.createElement(\n          Title,\n          null,\n          \"Add rule\"\n        ),\n        React.createElement(\n          \"div\",\n          {\n            className: \"box\"\n          },\n          React.createElement(\n            FormControl,\n            {\n              componentClass: \"select\",\n              onChange: this.addRule\n            },\n            VISITOR_AUDIENCE_RULES.map(function (rule, index) {\n              return React.createElement(\n                \"option\",\n                {\n                  key: index,\n                  value: rule.value\n                },\n                rule.text\n              );\n            })\n          )\n        ),\n        React.createElement(\n          \"div\",\n          {\n            className: \"box\"\n          },\n          this.state.rules.map(function (rule) {\n            return _this3.renderRule(rule);\n          })\n        )\n      );\n    }\n\n    return renderSidebarExtra;\n  }();\n\n  VisitorForm.prototype.renderContent = function () {\n    function renderContent() {\n      var message = this.getMessage();\n      return React.createElement(MessengerForm, {\n        message: message,\n        fromUser: this.state.fromUser || '',\n        onContentChange: this.onMessengerContentChange,\n        brands: this.props.brands\n      });\n    }\n\n    return renderContent;\n  }();\n\n  return VisitorForm;\n}(FormBase);\n\nVisitorForm.propTypes = propTypes;\nmodule.export(\"default\", exports.default = VisitorForm);","map":{"version":3,"sources":["/imports/react-ui/engage/components/VisitorForm.js"],"names":["React","module","importSync","v","PropTypes","FormControl","Button","ControlLabel","FormGroup","METHODS","MESSAGE_KINDS","Wrapper","VISITOR_AUDIENCE_RULES","RULE_CONDITIONS","FormBase","MessengerForm","propTypes","brands","array","VisitorForm","props","message","messenger","rules","state","messengerContent","onMessengerContentChange","bind","addRule","generateDoc","e","preventDefault","doc","kind","VISITOR_AUTO","title","document","getElementById","value","fromUserId","method","MESSENGER","brandId","sentAs","content","setState","selectedOption","target","options","selectedIndex","push","_id","Math","random","toString","text","condition","renderRule","rule","remove","filter","r","changeProp","name","currentRule","find","onChangeValue","onChangeCondition","map","cond","index","renderSidebarExtra","Section","Sidebar","Title","renderContent","getMessage","fromUser","export","exports","default"],"mappings":";;;;;;;;;;;;;;AAAA,IAAIA,cAAJ;AAAUC,OAAOC,UAAP,CAAkB,OAAlB,EAA0B;AAAC,aAAQ,UAASC,CAAT,EAAW;AAACH,YAAMG,CAAN;AAAQ;AAA7B,CAA1B,EAAyD,CAAzD;AAA4D,IAAIC,kBAAJ;AAAcH,OAAOC,UAAP,CAAkB,YAAlB,EAA+B;AAAC,aAAQ,UAASC,CAAT,EAAW;AAACC,gBAAUD,CAAV;AAAY;AAAjC,CAA/B,EAAkE,CAAlE;AAAqE,IAAIE,oBAAJ;AAAA,IAAgBC,eAAhB;AAAA,IAAuBC,qBAAvB;AAAA,IAAoCC,kBAApC;AAA8CP,OAAOC,UAAP,CAAkB,iBAAlB,EAAoC;AAACG,eAAY,UAASF,CAAT,EAAW;AAACE,kBAAYF,CAAZ;AAAc,GAAvC;AAAwCG,UAAO,UAASH,CAAT,EAAW;AAACG,aAAOH,CAAP;AAAS,GAApE;AAAqEI,gBAAa,UAASJ,CAAT,EAAW;AAACI,mBAAaJ,CAAb;AAAe,GAA7G;AAA8GK,aAAU,UAASL,CAAT,EAAW;AAACK,gBAAUL,CAAV;AAAY;AAAhJ,CAApC,EAAsL,CAAtL;AAAyL,IAAIM,gBAAJ;AAAA,IAAYC,sBAAZ;AAA0BT,OAAOC,UAAP,CAAkB,+BAAlB,EAAkD;AAACO,WAAQ,UAASN,CAAT,EAAW;AAACM,cAAQN,CAAR;AAAU,GAA/B;AAAgCO,iBAAc,UAASP,CAAT,EAAW;AAACO,oBAAcP,CAAd;AAAgB;AAA1E,CAAlD,EAA8H,CAA9H;AAAiI,IAAIQ,gBAAJ;AAAYV,OAAOC,UAAP,CAAkB,qCAAlB,EAAwD;AAACS,WAAQ,UAASR,CAAT,EAAW;AAACQ,cAAQR,CAAR;AAAU;AAA/B,CAAxD,EAAyF,CAAzF;AAA4F,IAAIS,+BAAJ;AAAA,IAA2BC,wBAA3B;AAA2CZ,OAAOC,UAAP,CAAkB,+BAAlB,EAAkD;AAACU,0BAAuB,UAAST,CAAT,EAAW;AAACS,6BAAuBT,CAAvB;AAAyB,GAA7D;AAA8DU,mBAAgB,UAASV,CAAT,EAAW;AAACU,sBAAgBV,CAAhB;AAAkB;AAA5G,CAAlD,EAAgK,CAAhK;AAAmK,IAAIW,iBAAJ;AAAab,OAAOC,UAAP,CAAkB,YAAlB,EAA+B;AAAC,aAAQ,UAASC,CAAT,EAAW;AAACW,eAASX,CAAT;AAAW;AAAhC,CAA/B,EAAiE,CAAjE;AAAoE,IAAIY,sBAAJ;AAAkBd,OAAOC,UAAP,CAAkB,iBAAlB,EAAoC;AAAC,aAAQ,UAASC,CAAT,EAAW;AAACY,oBAAcZ,CAAd;AAAgB;AAArC,CAApC,EAA2E,CAA3E;AAYp7B,IAAMa,YAAY;AAChBC,UAAQb,UAAUc;AADF,CAAlB;;IAIMC,W;;;AACJ,uBAAYC,KAAZ,EAAmB;AAAA;;AAAA,+DACjB,qBAAMA,KAAN,CADiB;;AAGjB,QAAMC,UAAUD,MAAMC,OAAN,IAAiB,EAAjC;AACA,QAAMC,YAAYD,QAAQC,SAAR,GAAoBD,QAAQC,SAA5B,GAAwC,EAA1D;AACA,QAAMC,QAAQD,UAAUC,KAAV,GAAkBD,UAAUC,KAA5B,GAAoC,EAAlD;AAEA,UAAKC,KAAL,GAAa;AAAEC,wBAAkB,EAApB;AAAwBF;AAAxB,KAAb,CAPiB,CASjB;;AACA,UAAKG,wBAAL,GAAgC,MAAKA,wBAAL,CAA8BC,IAA9B,OAAhC;AACA,UAAKC,OAAL,GAAe,MAAKA,OAAL,CAAaD,IAAb,OAAf;AAXiB;AAYlB;;wBAEDE,W;yBAAYC,C,EAAG;AACbA,QAAEC,cAAF;AAEA,UAAMC,MAAM;AACVC,cAAMvB,cAAcwB,YADV;AAEVC,eAAOC,SAASC,cAAT,CAAwB,OAAxB,EAAiCC,KAF9B;AAGVC,oBAAYH,SAASC,cAAT,CAAwB,YAAxB,EAAsCC,KAHxC;AAIVE,gBAAQ/B,QAAQgC,SAJN;AAKVnB,mBAAW;AACTC,iBAAO,KAAKC,KAAL,CAAWD,KADT;AAETmB,mBAASN,SAASC,cAAT,CAAwB,SAAxB,EAAmCC,KAFnC;AAGTK,kBAAQP,SAASC,cAAT,CAAwB,iBAAxB,EAA2CC,KAH1C;AAITM,mBAAS,KAAKpB,KAAL,CAAWC;AAJX;AALD,OAAZ;AAaA,aAAOO,GAAP;AACD;;;;;wBAEDN,wB;sCAAyBkB,O,EAAS;AAChC,WAAKC,QAAL,CAAc;AAAEpB,0BAAkBmB;AAApB,OAAd;AACD;;;;;wBAEDhB,O;qBAAQE,C,EAAG;AACT,UAAMP,QAAQ,KAAKC,KAAL,CAAWD,KAAzB;AAEA,UAAMuB,iBAAiBhB,EAAEiB,MAAF,CAASC,OAAT,CAAiBlB,EAAEiB,MAAF,CAASE,aAA1B,CAAvB;;AAEA,UAAIH,eAAeR,KAAnB,EAA0B;AACxBf,cAAM2B,IAAN,CAAW;AACTC,eAAKC,KAAKC,MAAL,GAAcC,QAAd,EADI;AAETrB,gBAAMa,eAAeR,KAFZ;AAGTiB,gBAAMT,eAAeS,IAHZ;AAITC,qBAAW,EAJF;AAKTlB,iBAAO;AALE,SAAX;AAQA,aAAKO,QAAL,CAAc;AAAEtB;AAAF,SAAd;AACD;AACF;;;;;wBAEDkC,U;wBAAWC,I,EAAM;AAAA;;AACf,UAAMC,SAAS,YAAM;AACnB,YAAIpC,QAAQ,OAAKC,KAAL,CAAWD,KAAvB;AAEAA,gBAAQA,MAAMqC,MAAN,CAAa;AAAA,iBAAKC,EAAEV,GAAF,KAAUO,KAAKP,GAApB;AAAA,SAAb,CAAR;;AAEA,eAAKN,QAAL,CAAc;AAAEtB;AAAF,SAAd;AACD,OAND;;AAQA,UAAMuC,aAAa,UAACC,IAAD,EAAOzB,KAAP,EAAiB;AAClC,YAAMf,QAAQ,OAAKC,KAAL,CAAWD,KAAzB,CADkC,CAGlC;;AACA,YAAMyC,cAAczC,MAAM0C,IAAN,CAAW;AAAA,iBAAKJ,EAAEV,GAAF,KAAUO,KAAKP,GAApB;AAAA,SAAX,CAApB,CAJkC,CAMlC;;AACAa,oBAAYD,IAAZ,IAAoBzB,KAApB;;AAEA,eAAKO,QAAL,CAAc;AAAEtB;AAAF,SAAd;AACD,OAVD;;AAYA,UAAM2C,gBAAgB,aAAK;AACzBJ,mBAAW,OAAX,EAAoBhC,EAAEiB,MAAF,CAAST,KAA7B;AACD,OAFD;;AAIA,UAAM6B,oBAAoB,aAAK;AAC7BL,mBAAW,WAAX,EAAwBhC,EAAEiB,MAAF,CAAST,KAAjC;AACD,OAFD;;AAIA,aACE;AAAC,iBAAD;AAAA;AAAW,eAAKoB,KAAKP;AAArB;AACE;AAAC,sBAAD;AAAA;AACGO,eAAKH,IADR;AAAA;AAAA,SADF;AAIE;AAAA;AAAA;AAAK,uBAAU;AAAf;AACE;AAAC,uBAAD;AAAA;AACE,yBAAU,WADZ;AAEE,8BAAe,QAFjB;AAGE,4BAAcG,KAAKF,SAHrB;AAIE,wBAAUW;AAJZ;AAMGtD,4BAAgB6C,KAAKzB,IAArB,EAA2BmC,GAA3B,CAA+B,UAACC,IAAD,EAAOC,KAAP;AAAA,qBAC9B;AAAA;AAAA;AAAQ,uBAAKA,KAAb;AAAoB,yBAAOD,KAAK/B;AAAhC;AACG+B,qBAAKd;AADR,eAD8B;AAAA,aAA/B;AANH,WADF;AAcE,8BAAC,WAAD;AACE,uBAAU,WADZ;AAEE,kBAAK,MAFP;AAGE,mBAAOG,KAAKpB,KAHd;AAIE,sBAAU4B;AAJZ,YAdF;AAqBE;AAAC,kBAAD;AAAA;AAAQ,yBAAU,WAAlB;AAA8B,sBAAO,OAArC;AAA6C,uBAASP,MAAtD;AAA8D,uBAAQ;AAAtE;AACE;AAAG,yBAAU;AAAb;AADF;AArBF;AAJF,OADF;AAgCD;;;;;wBAEDY,kB;kCAAqB;AAAA;;AAAA,UACXC,OADW,GACC7D,QAAQ8D,OADT,CACXD,OADW;AAAA,UAEXE,KAFW,GAED/D,QAAQ8D,OAAR,CAAgBD,OAFf,CAEXE,KAFW;AAInB,aACE;AAAC,eAAD;AAAA;AACE;AAAC,eAAD;AAAA;AAAA;AAAA,SADF;AAEE;AAAA;AAAA;AAAK,uBAAU;AAAf;AACE;AAAC,uBAAD;AAAA;AAAa,8BAAe,QAA5B;AAAqC,wBAAU,KAAK9C;AAApD;AACGhB,mCAAuBwD,GAAvB,CAA2B,UAACV,IAAD,EAAOY,KAAP;AAAA,qBAC1B;AAAA;AAAA;AAAQ,uBAAKA,KAAb;AAAoB,yBAAOZ,KAAKpB;AAAhC;AACGoB,qBAAKH;AADR,eAD0B;AAAA,aAA3B;AADH;AADF,SAFF;AAYE;AAAA;AAAA;AAAK,uBAAU;AAAf;AACG,eAAK/B,KAAL,CAAWD,KAAX,CAAiB6C,GAAjB,CAAqB;AAAA,mBAAQ,OAAKX,UAAL,CAAgBC,IAAhB,CAAR;AAAA,WAArB;AADH;AAZF,OADF;AAkBD;;;;;wBAEDiB,a;6BAAgB;AACd,UAAMtD,UAAU,KAAKuD,UAAL,EAAhB;AAEA,aACE,oBAAC,aAAD;AACE,iBAASvD,OADX;AAEE,kBAAU,KAAKG,KAAL,CAAWqD,QAAX,IAAuB,EAFnC;AAGE,yBAAiB,KAAKnD,wBAHxB;AAIE,gBAAQ,KAAKN,KAAL,CAAWH;AAJrB,QADF;AAQD;;;;;;EA1JuBH,Q;;AA6J1BK,YAAYH,SAAZ,GAAwBA,SAAxB;AA7KAf,OAAO6E,MAAP,CAAc,SAAd,EAAwBC,QAAQC,OAAR,GA+KT7D,WA/Kf","file":"/imports/react-ui/engage/components/VisitorForm.js.map","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport { FormControl, Button, ControlLabel, FormGroup } from 'react-bootstrap';\n\nimport { METHODS, MESSAGE_KINDS } from '/imports/api/engage/constants';\nimport { Wrapper } from '/imports/react-ui/layout/components';\n\nimport { VISITOR_AUDIENCE_RULES, RULE_CONDITIONS } from '/imports/api/engage/constants';\n\nimport FormBase from './FormBase';\nimport MessengerForm from './MessengerForm';\n\nconst propTypes = {\n  brands: PropTypes.array,\n};\n\nclass VisitorForm extends FormBase {\n  constructor(props) {\n    super(props);\n\n    const message = props.message || {};\n    const messenger = message.messenger ? message.messenger : {};\n    const rules = messenger.rules ? messenger.rules : [];\n\n    this.state = { messengerContent: '', rules };\n\n    // binds\n    this.onMessengerContentChange = this.onMessengerContentChange.bind(this);\n    this.addRule = this.addRule.bind(this);\n  }\n\n  generateDoc(e) {\n    e.preventDefault();\n\n    const doc = {\n      kind: MESSAGE_KINDS.VISITOR_AUTO,\n      title: document.getElementById('title').value,\n      fromUserId: document.getElementById('fromUserId').value,\n      method: METHODS.MESSENGER,\n      messenger: {\n        rules: this.state.rules,\n        brandId: document.getElementById('brandId').value,\n        sentAs: document.getElementById('messengerSentAs').value,\n        content: this.state.messengerContent,\n      },\n    };\n\n    return doc;\n  }\n\n  onMessengerContentChange(content) {\n    this.setState({ messengerContent: content });\n  }\n\n  addRule(e) {\n    const rules = this.state.rules;\n\n    const selectedOption = e.target.options[e.target.selectedIndex];\n\n    if (selectedOption.value) {\n      rules.push({\n        _id: Math.random().toString(),\n        kind: selectedOption.value,\n        text: selectedOption.text,\n        condition: '',\n        value: '',\n      });\n\n      this.setState({ rules });\n    }\n  }\n\n  renderRule(rule) {\n    const remove = () => {\n      let rules = this.state.rules;\n\n      rules = rules.filter(r => r._id !== rule._id);\n\n      this.setState({ rules });\n    };\n\n    const changeProp = (name, value) => {\n      const rules = this.state.rules;\n\n      // find current editing one\n      const currentRule = rules.find(r => r._id === rule._id);\n\n      // set new value\n      currentRule[name] = value;\n\n      this.setState({ rules });\n    };\n\n    const onChangeValue = e => {\n      changeProp('value', e.target.value);\n    };\n\n    const onChangeCondition = e => {\n      changeProp('condition', e.target.value);\n    };\n\n    return (\n      <FormGroup key={rule._id}>\n        <ControlLabel>\n          {rule.text}:\n        </ControlLabel>\n        <div className=\"flex-form\">\n          <FormControl\n            className=\"flex-item\"\n            componentClass=\"select\"\n            defaultValue={rule.condition}\n            onChange={onChangeCondition}\n          >\n            {RULE_CONDITIONS[rule.kind].map((cond, index) => (\n              <option key={index} value={cond.value}>\n                {cond.text}\n              </option>\n            ))}\n          </FormControl>\n\n          <FormControl\n            className=\"flex-item\"\n            type=\"text\"\n            value={rule.value}\n            onChange={onChangeValue}\n          />\n\n          <Button className=\"flex-item\" bsSize=\"small\" onClick={remove} bsStyle=\"danger\">\n            <i className=\"ion-close-round\" />\n          </Button>\n        </div>\n      </FormGroup>\n    );\n  }\n\n  renderSidebarExtra() {\n    const { Section } = Wrapper.Sidebar;\n    const { Title } = Wrapper.Sidebar.Section;\n\n    return (\n      <Section>\n        <Title>Add rule</Title>\n        <div className=\"box\">\n          <FormControl componentClass=\"select\" onChange={this.addRule}>\n            {VISITOR_AUDIENCE_RULES.map((rule, index) => (\n              <option key={index} value={rule.value}>\n                {rule.text}\n              </option>\n            ))}\n          </FormControl>\n        </div>\n\n        <div className=\"box\">\n          {this.state.rules.map(rule => this.renderRule(rule))}\n        </div>\n      </Section>\n    );\n  }\n\n  renderContent() {\n    const message = this.getMessage();\n\n    return (\n      <MessengerForm\n        message={message}\n        fromUser={this.state.fromUser || ''}\n        onContentChange={this.onMessengerContentChange}\n        brands={this.props.brands}\n      />\n    );\n  }\n}\n\nVisitorForm.propTypes = propTypes;\n\nexport default VisitorForm;\n"]},"hash":"e0ca982d088f4a40aaf48dd5e722046bc36955d5"}
