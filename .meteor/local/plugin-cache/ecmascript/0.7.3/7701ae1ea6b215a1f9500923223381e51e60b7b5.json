{"metadata":{"usedHelpers":["inherits","possibleConstructorReturn","classCallCheck","interopRequireDefault"],"marked":[],"modules":{"imports":[{"source":"meteor/underscore","imported":["_"],"specifiers":[{"kind":"named","imported":"_","local":"_"}]},{"source":"meteor/erxes-notifier","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"Alert"}]},{"source":"react","imported":["default","PropTypes","Component"],"specifiers":[{"kind":"named","imported":"default","local":"React"},{"kind":"named","imported":"PropTypes","local":"PropTypes"},{"kind":"named","imported":"Component","local":"Component"}]},{"source":"meteor/kadira:flow-router","imported":["FlowRouter"],"specifiers":[{"kind":"named","imported":"FlowRouter","local":"FlowRouter"}]},{"source":"strip","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"strip"}]},{"source":"react-bootstrap","imported":["Button","FormControl","Popover","OverlayTrigger"],"specifiers":[{"kind":"named","imported":"Button","local":"Button"},{"kind":"named","imported":"FormControl","local":"FormControl"},{"kind":"named","imported":"Popover","local":"Popover"},{"kind":"named","imported":"OverlayTrigger","local":"OverlayTrigger"}]},{"source":"/imports/react-ui/common","imported":["EmptyState"],"specifiers":[{"kind":"named","imported":"EmptyState","local":"EmptyState"}]},{"source":"./ResponseTemplateModal","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"ResponseTemplateModal"}]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"/imports/react-ui/inbox/components/details/ResponseTemplate.js","filenameRelative":"/imports/react-ui/inbox/components/details/ResponseTemplate.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/imports/react-ui/inbox/components/details/ResponseTemplate.js.map","sourceFileName":"/imports/react-ui/inbox/components/details/ResponseTemplate.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"ResponseTemplate"},"ignored":false,"code":"var _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _possibleConstructorReturn2 = require(\"babel-runtime/helpers/possibleConstructorReturn\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require(\"babel-runtime/helpers/inherits\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nvar _ = void 0;\n\nmodule.importSync(\"meteor/underscore\", {\n  _: function (v) {\n    _ = v;\n  }\n}, 0);\nvar Alert = void 0;\nmodule.importSync(\"meteor/erxes-notifier\", {\n  \"default\": function (v) {\n    Alert = v;\n  }\n}, 1);\nvar React = void 0,\n    PropTypes = void 0,\n    Component = void 0;\nmodule.importSync(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  },\n  PropTypes: function (v) {\n    PropTypes = v;\n  },\n  Component: function (v) {\n    Component = v;\n  }\n}, 2);\nvar FlowRouter = void 0;\nmodule.importSync(\"meteor/kadira:flow-router\", {\n  FlowRouter: function (v) {\n    FlowRouter = v;\n  }\n}, 3);\nvar strip = void 0;\nmodule.importSync(\"strip\", {\n  \"default\": function (v) {\n    strip = v;\n  }\n}, 4);\nvar Button = void 0,\n    FormControl = void 0,\n    Popover = void 0,\n    OverlayTrigger = void 0;\nmodule.importSync(\"react-bootstrap\", {\n  Button: function (v) {\n    Button = v;\n  },\n  FormControl: function (v) {\n    FormControl = v;\n  },\n  Popover: function (v) {\n    Popover = v;\n  },\n  OverlayTrigger: function (v) {\n    OverlayTrigger = v;\n  }\n}, 5);\nvar EmptyState = void 0;\nmodule.importSync(\"/imports/react-ui/common\", {\n  EmptyState: function (v) {\n    EmptyState = v;\n  }\n}, 6);\nvar ResponseTemplateModal = void 0;\nmodule.importSync(\"./ResponseTemplateModal\", {\n  \"default\": function (v) {\n    ResponseTemplateModal = v;\n  }\n}, 7);\nvar propTypes = {\n  brandId: PropTypes.string.isRequired,\n  responseTemplates: PropTypes.array.isRequired,\n  onSelect: PropTypes.func.isRequired,\n  attachments: PropTypes.array,\n  brands: PropTypes.array,\n  content: PropTypes.string.isRequired\n};\n\nvar ResponseTemplate = function (_Component) {\n  (0, _inherits3.default)(ResponseTemplate, _Component);\n\n  function ResponseTemplate(props) {\n    (0, _classCallCheck3.default)(this, ResponseTemplate);\n\n    var _this = (0, _possibleConstructorReturn3.default)(this, _Component.call(this, props));\n\n    _this.state = {\n      key: '',\n      brandId: props.brandId,\n      options: _this.filterByBrand(props.brandId)\n    };\n    _this.onSelect = _this.onSelect.bind(_this);\n    _this.onSave = _this.onSave.bind(_this);\n    _this.filterItems = _this.filterItems.bind(_this);\n    _this.onFilter = _this.onFilter.bind(_this);\n    _this.filterByBrand = _this.filterByBrand.bind(_this);\n    return _this;\n  }\n\n  ResponseTemplate.prototype.onSave = function () {\n    function onSave(brandId, name) {\n      var doc = {\n        brandId: brandId,\n        name: name,\n        content: this.props.content,\n        files: this.props.attachments\n      };\n      Meteor.call('responseTemplates.add', {\n        doc: doc\n      }, function (error) {\n        if (error) return Alert.error(error.message);\n        Alert.success('Congrats');\n        return document.querySelector('button.close').click();\n      });\n    }\n\n    return onSave;\n  }();\n\n  ResponseTemplate.prototype.onSelect = function () {\n    function onSelect(eventKey) {\n      var responseTemplates = this.props.responseTemplates; // find response template using event key\n\n      var responseTemplate = _.find(responseTemplates, function (t) {\n        return t._id === eventKey;\n      }); // hide selector\n\n\n      this.refs.overlay.hide();\n      return this.props.onSelect(responseTemplate);\n    }\n\n    return onSelect;\n  }();\n\n  ResponseTemplate.prototype.onFilter = function () {\n    function onFilter(e) {\n      var options = this.filterByBrand(e.target.value);\n      this.setState({\n        options: options,\n        brandId: e.target.value\n      });\n    }\n\n    return onFilter;\n  }();\n\n  ResponseTemplate.prototype.filterByBrand = function () {\n    function filterByBrand(brandId) {\n      return _.filter(this.props.responseTemplates, function (option) {\n        return option.brandId === brandId;\n      });\n    }\n\n    return filterByBrand;\n  }();\n\n  ResponseTemplate.prototype.filterItems = function () {\n    function filterItems(e) {\n      this.setState({\n        key: e.target.value\n      });\n    }\n\n    return filterItems;\n  }();\n\n  ResponseTemplate.prototype.renderItems = function () {\n    function renderItems() {\n      var _this2 = this;\n\n      var _state = this.state,\n          options = _state.options,\n          key = _state.key;\n\n      if (options.length === 0) {\n        return React.createElement(EmptyState, {\n          icon: React.createElement(\"i\", {\n            className: \"ion-clipboard\"\n          }),\n          text: \"No templates\",\n          size: \"small\"\n        });\n      }\n\n      return options.map(function (item) {\n        // filter items by key\n        if (key && item.name.toLowerCase().indexOf(key) < 0 && key && item.content.toLowerCase().indexOf(key) < 0) {\n          return false;\n        }\n\n        return React.createElement(\n          \"li\",\n          {\n            key: item._id,\n            onClick: function () {\n              return _this2.onSelect(item._id);\n            }\n          },\n          React.createElement(\n            \"div\",\n            {\n              className: \"template-title\"\n            },\n            item.name\n          ),\n          React.createElement(\n            \"div\",\n            {\n              className: \"template-content\"\n            },\n            strip(item.content)\n          )\n        );\n      });\n    }\n\n    return renderItems;\n  }();\n\n  ResponseTemplate.prototype.render = function () {\n    function render() {\n      var _props = this.props,\n          brands = _props.brands,\n          content = _props.content,\n          brandId = _props.brandId;\n      var saveTrigger = React.createElement(\n        Button,\n        {\n          id: \"response-template-handler\",\n          bsStyle: \"link\"\n        },\n        React.createElement(\"i\", {\n          className: \"ion-archive\"\n        }),\n        \" Save as template\"\n      );\n      var popover = React.createElement(\n        Popover,\n        {\n          className: \"popover-template\",\n          id: \"templates-popover\",\n          title: \"Response Templates\"\n        },\n        React.createElement(\n          \"div\",\n          {\n            className: \"popover-header\"\n          },\n          React.createElement(\n            \"div\",\n            {\n              className: \"inline-header\"\n            },\n            React.createElement(\n              \"div\",\n              {\n                className: \"column\"\n              },\n              React.createElement(FormControl, {\n                type: \"text\",\n                placeholder: \"Search...\",\n                onChange: this.filterItems,\n                autoFocus: true\n              })\n            ),\n            React.createElement(\n              \"div\",\n              {\n                className: \"column\"\n              },\n              React.createElement(\n                FormControl,\n                {\n                  componentClass: \"select\",\n                  placeholder: \"Select Brand\",\n                  onChange: this.onFilter,\n                  defaultValue: this.state.brandId\n                },\n                brands.map(function (brand) {\n                  return React.createElement(\n                    \"option\",\n                    {\n                      key: brand._id,\n                      value: brand._id\n                    },\n                    brand.name\n                  );\n                })\n              )\n            )\n          )\n        ),\n        React.createElement(\n          \"div\",\n          {\n            className: \"popover-body\"\n          },\n          React.createElement(\n            \"ul\",\n            {\n              className: \"popover-list\"\n            },\n            this.renderItems()\n          )\n        ),\n        React.createElement(\n          \"div\",\n          {\n            className: \"popover-footer\"\n          },\n          React.createElement(\n            \"ul\",\n            {\n              className: \"popover-list linked text-center\"\n            },\n            React.createElement(\n              \"li\",\n              null,\n              React.createElement(\n                \"a\",\n                {\n                  href: FlowRouter.path('settings/responseTemplates/list')\n                },\n                \"Manage templates\"\n              )\n            )\n          )\n        )\n      );\n      return React.createElement(\n        \"div\",\n        {\n          className: \"response-template\"\n        },\n        React.createElement(\n          OverlayTrigger,\n          {\n            trigger: \"click\",\n            placement: \"top\",\n            overlay: popover,\n            rootClose: true,\n            ref: \"overlay\"\n          },\n          React.createElement(\n            Button,\n            {\n              bsStyle: \"link\",\n              className: \"dropup\"\n            },\n            React.createElement(\"i\", {\n              className: \"ion-clipboard\"\n            }),\n            \" Templates \",\n            React.createElement(\"span\", {\n              className: \"caret\"\n            })\n          )\n        ),\n        React.createElement(ResponseTemplateModal, {\n          trigger: strip(content) ? saveTrigger : React.createElement(\"span\", null),\n          brands: brands,\n          brandId: brandId,\n          onSave: this.onSave\n        })\n      );\n    }\n\n    return render;\n  }();\n\n  return ResponseTemplate;\n}(Component);\n\nResponseTemplate.propTypes = propTypes;\nmodule.export(\"default\", exports.default = ResponseTemplate);","map":{"version":3,"sources":["/imports/react-ui/inbox/components/details/ResponseTemplate.js"],"names":["_","module","importSync","v","Alert","React","PropTypes","Component","FlowRouter","strip","Button","FormControl","Popover","OverlayTrigger","EmptyState","ResponseTemplateModal","propTypes","brandId","string","isRequired","responseTemplates","array","onSelect","func","attachments","brands","content","ResponseTemplate","props","state","key","options","filterByBrand","bind","onSave","filterItems","onFilter","name","doc","files","Meteor","call","error","message","success","document","querySelector","click","eventKey","responseTemplate","find","t","_id","refs","overlay","hide","e","target","value","setState","filter","option","renderItems","length","map","item","toLowerCase","indexOf","render","saveTrigger","popover","brand","path","export","exports","default"],"mappings":"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","file":"/imports/react-ui/inbox/components/details/ResponseTemplate.js.map","sourcesContent":["import { _ } from 'meteor/underscore';\nimport Alert from 'meteor/erxes-notifier';\nimport React, { PropTypes, Component } from 'react';\nimport { FlowRouter } from 'meteor/kadira:flow-router';\nimport strip from 'strip';\nimport { Button, FormControl, Popover, OverlayTrigger } from 'react-bootstrap';\n\nimport { EmptyState } from '/imports/react-ui/common';\nimport ResponseTemplateModal from './ResponseTemplateModal';\n\nconst propTypes = {\n  brandId: PropTypes.string.isRequired,\n  responseTemplates: PropTypes.array.isRequired,\n  onSelect: PropTypes.func.isRequired,\n  attachments: PropTypes.array,\n  brands: PropTypes.array,\n  content: PropTypes.string.isRequired,\n};\n\nclass ResponseTemplate extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      key: '',\n      brandId: props.brandId,\n      options: this.filterByBrand(props.brandId),\n    };\n\n    this.onSelect = this.onSelect.bind(this);\n    this.onSave = this.onSave.bind(this);\n    this.filterItems = this.filterItems.bind(this);\n    this.onFilter = this.onFilter.bind(this);\n    this.filterByBrand = this.filterByBrand.bind(this);\n  }\n\n  onSave(brandId, name) {\n    const doc = {\n      brandId,\n      name,\n      content: this.props.content,\n      files: this.props.attachments,\n    };\n\n    Meteor.call('responseTemplates.add', { doc }, error => {\n      if (error) return Alert.error(error.message);\n\n      Alert.success('Congrats');\n\n      return document.querySelector('button.close').click();\n    });\n  }\n\n  onSelect(eventKey) {\n    const responseTemplates = this.props.responseTemplates;\n\n    // find response template using event key\n    const responseTemplate = _.find(responseTemplates, t => t._id === eventKey);\n\n    // hide selector\n    this.refs.overlay.hide();\n\n    return this.props.onSelect(responseTemplate);\n  }\n\n  onFilter(e) {\n    const options = this.filterByBrand(e.target.value);\n    this.setState({ options, brandId: e.target.value });\n  }\n\n  filterByBrand(brandId) {\n    return _.filter(this.props.responseTemplates, option => option.brandId === brandId);\n  }\n\n  filterItems(e) {\n    this.setState({ key: e.target.value });\n  }\n\n  renderItems() {\n    const { options, key } = this.state;\n\n    if (options.length === 0) {\n      return <EmptyState icon={<i className=\"ion-clipboard\" />} text=\"No templates\" size=\"small\" />;\n    }\n\n    return options.map(item => {\n      // filter items by key\n      if (\n        key &&\n        item.name.toLowerCase().indexOf(key) < 0 &&\n        (key && item.content.toLowerCase().indexOf(key) < 0)\n      ) {\n        return false;\n      }\n\n      return (\n        <li key={item._id} onClick={() => this.onSelect(item._id)}>\n          <div className=\"template-title\">\n            {item.name}\n          </div>\n          <div className=\"template-content\">\n            {strip(item.content)}\n          </div>\n        </li>\n      );\n    });\n  }\n\n  render() {\n    const { brands, content, brandId } = this.props;\n\n    const saveTrigger = (\n      <Button id=\"response-template-handler\" bsStyle=\"link\">\n        <i className=\"ion-archive\" /> Save as template\n      </Button>\n    );\n\n    const popover = (\n      <Popover className=\"popover-template\" id=\"templates-popover\" title=\"Response Templates\">\n        <div className=\"popover-header\">\n          <div className=\"inline-header\">\n            <div className=\"column\">\n              <FormControl\n                type=\"text\"\n                placeholder=\"Search...\"\n                onChange={this.filterItems}\n                autoFocus\n              />\n            </div>\n            <div className=\"column\">\n              <FormControl\n                componentClass=\"select\"\n                placeholder=\"Select Brand\"\n                onChange={this.onFilter}\n                defaultValue={this.state.brandId}\n              >\n                {brands.map(brand => (\n                  <option key={brand._id} value={brand._id}>\n                    {brand.name}\n                  </option>\n                ))}\n              </FormControl>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"popover-body\">\n          <ul className=\"popover-list\">\n            {this.renderItems()}\n          </ul>\n        </div>\n        <div className=\"popover-footer\">\n          <ul className=\"popover-list linked text-center\">\n            <li>\n              <a href={FlowRouter.path('settings/responseTemplates/list')}>Manage templates</a>\n            </li>\n          </ul>\n        </div>\n      </Popover>\n    );\n\n    return (\n      <div className=\"response-template\">\n        <OverlayTrigger trigger=\"click\" placement=\"top\" overlay={popover} rootClose ref=\"overlay\">\n          <Button bsStyle=\"link\" className=\"dropup\">\n            <i className=\"ion-clipboard\" /> Templates <span className=\"caret\" />\n          </Button>\n        </OverlayTrigger>\n\n        <ResponseTemplateModal\n          trigger={strip(content) ? saveTrigger : <span />}\n          brands={brands}\n          brandId={brandId}\n          onSave={this.onSave}\n        />\n      </div>\n    );\n  }\n}\n\nResponseTemplate.propTypes = propTypes;\n\nexport default ResponseTemplate;\n"]},"hash":"7701ae1ea6b215a1f9500923223381e51e60b7b5"}
